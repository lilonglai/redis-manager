webpackJsonp([1],{"36zs":function(e,t){},"4/hK":function(e,t){},"4RNS":function(e,t){},"7xIN":function(e,t){},AVYe:function(e,t){},As7w:function(e,t){},DQH3:function(e,t){},GX4J:function(e,t){},JwGp:function(e,t){},Kuh7:function(e,t){},Lgoy:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("pFYg"),s=r.n(a),n=r("8U58");r("4/hK");var i={props:{value:{type:String,default:""},options:{type:Object,default:function(){return{mode:"text/javascript",lineNumbers:!0,lineWrapping:!0}}}},data:function(){return{skipNextChangeEvent:!1}},ready:function(){var e=this;this.editor=n.fromTextArea(this.$el.querySelector("textarea"),this.options),this.editor.setValue(this.value),this.editor.on("change",function(t){e.skipNextChangeEvent?e.skipNextChangeEvent=!1:(e.value=t.getValue(),e.$emit&&e.$emit("change",t.getValue()))})},mounted:function(){var e=this;this.editor=n.fromTextArea(this.$el.querySelector("textarea"),this.options),this.editor.setValue(this.value),this.editor.on("change",function(t){e.skipNextChangeEvent?e.skipNextChangeEvent=!1:e.$emit&&(e.$emit("change",t.getValue()),e.$emit("input",t.getValue()))})},watch:{value:function(e,t){if(e!==this.editor.getValue()){this.skipNextChangeEvent=!0;var r=this.editor.getScrollInfo();this.editor.setValue(e),this.editor.scrollTo(r.left,r.top)}},options:function(e,t){if("object"===(void 0===e?"undefined":s()(e)))for(var r in e)e.hasOwnProperty(r)&&this.editor.setOption(r,e[r])}},beforeDestroy:function(){this.editor&&this.editor.toTextArea()}},l=r("VU/8")(i,{render:function(){return this.$createElement,this._self._c,this._m(0)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"vue-codemirror-wrap"},[t("textarea")])}]},!1,function(e){r("NAmH")},null,null);t.default=l.exports},LnKd:function(e,t){},NAmH:function(e,t){},NHnr:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("7+uW"),s=r("NYxO"),n=r("424j"),i=r("mtWM"),l=r.n(i);function o(e){return null==e||"undefined"===e||""===e||"null"===e}function u(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}function c(e){return/^1[3|4|5|7|8][0-9]{9}$/.test(e)}function d(e){return/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\:([0-9]|[1-9]\d|[1-9]\d{2}|[1-9]\d{3}|[1-5]\d{4}|6[0-4]\d{3}|65[0-4]\d{2}|655[0-2]\d|6553[0-5])$/.test(e)}var p=r("zL8q"),m=r.n(p);function f(e,t){var r={showClose:!0,message:e,offset:60};o(t)||(r.type=t),"success"===t?p.Message.success(r):"warning"===t?p.Message.warning(r):"error"===t?p.Message.error(r):p.Message.info(r)}var v={info:function(e){return f(e,null)},success:function(e){return f(e,"success")},warning:function(e){return f(e,"warning")},error:function(e){return f(e,"error")}},h=r("/ocq"),g={data:function(){return{user:{},authorization:{},rules:{userName:[{required:!0,message:"Please enter user name",trigger:"blur"}],password:[{required:!0,message:"Please enter password",trigger:"blur"}]}}},methods:{getAuthorization:function(){var e=this;Le.get("/system/getAuthorization",null,function(t){var r=t.data.data;r.server+=r.server.endsWith("/")?"":"/",e.authorization=r},function(e){v.error("Get authorization failed")})},signIn:function(e){var t=this;this.$refs[e].validate(function(e){e&&Le.post("/user/login",t.user,function(e){var r=e.data;0==r.code?(Ae.dispatch("setUser",r.data),t.$router.push({name:"index"})):v.error("User name or password wrong")},function(e){v.error(e)})})}},mounted:function(){this.getAuthorization(),Ae.dispatch("setUser",{userRole:2}),Ae.dispatch("setCurrentGroup",{}),Ae.dispatch("setGroupList",[])}},b={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{staticStyle:{"background-image":"linear-gradient(0deg,#1ac5fa,#2ba3de 51%,#1d71f2)"}},[a("img",{staticStyle:{position:"absolute","z-index":"0",left:"0",top:"32%",width:"100%",opacity:"0.1"},attrs:{src:r("cf+J")}}),e._v(" "),a("div",{staticClass:"login-wrapper"},[a("el-card",{staticClass:"content-wrapper",attrs:{shadow:"hover"}},[a("div",{attrs:{slot:"header"},slot:"header"},[a("b",[e._v("Sign In")])]),e._v(" "),a("div",[a("el-form",{ref:"user",attrs:{model:e.user,rules:e.rules}},[a("el-form-item",{attrs:{prop:"userName"}},[a("el-input",{attrs:{"prefix-icon":"el-icon-user",placeholder:"User Name"},model:{value:e.user.userName,callback:function(t){e.$set(e.user,"userName","string"==typeof t?t.trim():t)},expression:"user.userName"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"password"}},[a("el-input",{attrs:{"prefix-icon":"el-icon-key",type:"password",placeholder:"Password","show-password":""},model:{value:e.user.password,callback:function(t){e.$set(e.user,"password","string"==typeof t?t.trim():t)},expression:"user.password"}})],1),e._v(" "),a("el-form-item",[a("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:function(t){return e.signIn("user")}}},[e._v("Sign In")])],1),e._v(" "),e.authorization.enabled?a("el-form-item",[a("el-button",{staticStyle:{width:"100%"},attrs:{type:"success"}},[a("el-link",{staticStyle:{color:"#fff"},attrs:{href:e.authorization.server+e.authorization.siteKey,underline:!1}},[e._v(e._s(e.authorization.companyName)+" Sign In")])],1)],1):e._e()],1)],1),e._v(" "),a("div",{staticClass:"link-wrapper"},[a("span",[a("span",[e._v("More about")]),e._v(" "),a("el-link",{staticClass:"doc-link",attrs:{type:"primary",target:"_blank",href:"https://github.com/ngbdf/redis-manager/",underline:!1}},[e._v("Redis Manager")])],1)])])],1)])},staticRenderFns:[]},_=r("VU/8")(g,b,!1,function(e){r("V7r3")},"data-v-cfca07b0",null).exports;function C(e){var t=new Date(e),r=t.getFullYear(),a=t.getMonth()+1,s=t.getDate(),n=t.getHours(),i=t.getMinutes(),l=t.getSeconds();return r+"-"+w(a)+"-"+w(s)+" "+w(n)+":"+w(i)+":"+w(l)}function w(e){return e<10?"0"+e:e}function y(e,t){var r=Ae.getters.getCurrentGroup.groupId;if(o(r))ke.push({name:"404"});else{var a="/cluster/getCluster/"+r+"/"+e;Le.get(a,null,function(e){var r=e.data;0===r.code?t(r.data):(ke.push({name:"404"}),v.error("Get clsuter failed"))},function(e){v.error(e)})}}var k={props:{clusterId:{type:Number}},data:function(){var e=this;return{cluster:{nodeList:[{value:""}]},rules:{clusterName:[{required:!0,validator:function(t,r,a){if(o(r)||o(r.trim()))return a(new Error("Please enter cluster name"));var s="/cluster/validateClusterName/"+r;Le.get(s,null,function(t){var s=t.data;if(0!=s.code){var n=s.data;return e.clusterId==n.clusterId&&r==n.clusterName&&a(),a(new Error(r+" has exist"))}a()},function(e){return a(new Error("Network error, "+e))})},trigger:"blur"}],redisNode:[{required:!0,validator:function(e,t,r){if(o(t)||o(t.trim()))return r(new Error("Please enter redis node"));r()},trigger:"blur"},{required:!0,validator:function(t,r,a){var s={redisPassword:e.cluster.redisPassword},n=r.split(":"),i={host:n[0],port:n[1]};s.redisNode=i,Le.post("/validate/redisNode",s,function(e){if(0!=e.data.code)return a(new Error("Connection refused."));a()},function(e){return a(new Error("Network error, "+e))})},trigger:"blur"}],installationEnvironment:[{required:!0,validator:function(e,t,r){if(o(t))return r(new Error("Please select environment"));r()},trigger:"change"}]},saveClusterLoading:!1}},methods:{saveCluster:function(e){var t=this;this.$refs[e].validate(function(r){if(r){var a=t.currentGroup;if(o(a)||o(a.groupId))return;t.cluster.groupId=a.groupId,t.cluster.userId=Ae.getters.getUserId;var s="";t.cluster.nodeList.forEach(function(e){s+=e.value+","}),t.cluster.nodes=s;var n;n=o(t.clusterId)?"/cluster/importCluster":"/cluster/updateCluster",t.saveClusterLoading=!0,Le.post(n,t.cluster,function(r){0==r.data.code?(t.$refs[e].resetFields(),t.$router.push({name:"dashboard",params:{groupId:a.groupId}}),t.$emit("closeDialog",!1)):console.error("Save cluster failed"),t.saveClusterLoading=!1},function(e){t.saveClusterLoading=!1,console.error(e)})}})},removeNode:function(e){if(!(this.cluster.nodeList.length<=1)){var t=this.cluster.nodeList.indexOf(e);-1!==t&&this.cluster.nodeList.splice(t,1)}},addNode:function(){this.cluster.nodeList.length>=5||this.cluster.nodeList.push({value:"",key:Date.now()})},nodesToNodeList:function(e){var t=[];return e.split(",").forEach(function(e){o(e)||t.push({value:e})}),t}},computed:{currentGroup:function(){return Ae.getters.getCurrentGroup},installationEnvironmentList:function(){return Ae.getters.getInstallationEnvironmentList}},mounted:function(){var e=this;o(this.clusterId)?this.cluster={nodeList:[{value:""}]}:y(this.clusterId,function(t){var r=e.nodesToNodeList(t.nodes);t.nodeList=r,e.cluster=t})}},I=r("VU/8")(k,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.saveClusterLoading,expression:"saveClusterLoading"}]},[r("el-form",{ref:"cluster",attrs:{model:e.cluster,rules:e.rules,"label-width":"120px",size:"small"}},[r("el-form-item",{attrs:{label:"Group Name"}},[r("el-tag",{attrs:{size:"small"}},[e._v(e._s(e.currentGroup.groupName))])],1),e._v(" "),r("el-form-item",{attrs:{label:"Cluster Name",prop:"clusterName"}},[r("el-input",{attrs:{maxlength:"30","show-word-limit":""},model:{value:e.cluster.clusterName,callback:function(t){e.$set(e.cluster,"clusterName",t)},expression:"cluster.clusterName"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Redis Password",prop:"redisPassword"}},[r("el-input",{attrs:{maxlength:"255","show-password":""},model:{value:e.cluster.redisPassword,callback:function(t){e.$set(e.cluster,"redisPassword","string"==typeof t?t.trim():t)},expression:"cluster.redisPassword"}})],1),e._v(" "),e._l(e.cluster.nodeList,function(t,a){return r("el-form-item",{key:t.key,attrs:{label:"Redis Node "+(a+1),prop:"nodeList."+a+".value",rules:e.rules.redisNode}},[r("el-input",{model:{value:t.value,callback:function(r){e.$set(t,"value","string"==typeof r?r.trim():r)},expression:"node.value"}},[r("el-button",{attrs:{slot:"append",icon:"el-icon-delete"},on:{click:function(r){return r.preventDefault(),e.removeNode(t)}},slot:"append"})],1)],1)}),e._v(" "),r("el-form-item",{attrs:{label:"Environment",prop:"installationEnvironment"}},[r("el-radio-group",{model:{value:e.cluster.installationEnvironment,callback:function(t){e.$set(e.cluster,"installationEnvironment",t)},expression:"cluster.installationEnvironment"}},e._l(e.installationEnvironmentList,function(t){return r("el-radio",{key:t.type,attrs:{label:t.type}},[e._v(e._s(t.name))])}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"Cluster Info",prop:"clusterInfo"}},[r("el-input",{model:{value:e.cluster.clusterInfo,callback:function(t){e.$set(e.cluster,"clusterInfo",t)},expression:"cluster.clusterInfo"}})],1)],2),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){return e.addNode()}}},[e._v("New Node")]),e._v(" "),null==e.clusterId||""==e.clusterId?r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.saveCluster("cluster")}}},[e._v("Confirm")]):r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.saveCluster("cluster")}}},[e._v("Update")])],1)],1)},staticRenderFns:[]},!1,function(e){r("jR2h")},"data-v-696ee0a8",null).exports;r("uk2G");var L={components:{editCluster:I},data:function(){return{isCollapse:!1,active:!0,permission:!0,importVisible:!1,selectGroupId:""}},methods:{signOut:function(){var e=this;Le.post("/user/signOut",null,function(t){e.$router.push({name:"login"})},function(e){v.error(e)})},toDashboard:function(){this.$router.push({name:"dashboard",params:{groupId:this.selectGroupId}})},toInstallation:function(){this.$router.push({name:"installation",params:{groupId:this.selectGroupId}})},toChannelManage:function(){this.$router.push({name:"channel-manage",params:{groupId:this.selectGroupId}})},toRuleManage:function(){this.$router.push({name:"rule-manage",params:{groupId:this.selectGroupId}})},toMachineManage:function(){this.$router.push({name:"machine-manage",params:{groupId:this.selectGroupId}})},toGroupManage:function(){this.$router.push({name:"group-manage"})},toEditHistory:function(){this.$router.push({name:"edit-history",params:{groupId:this.selectGroupId}})},toUserManage:function(){this.$router.push({name:"user-manage",params:{groupId:this.selectGroupId}})},selectGroup:function(){var e=this;if(o(this.selectGroupId))v.error("Select group failed");else{this.groupList.forEach(function(t){e.selectGroupId===t.groupId&&e.getUserRole(t)});var t=this.$route.path;("/"===t||t.indexOf("redis-monitor")>0||t.indexOf("group-manage")>0)&&this.toDashboard()}},getUserRole:function(e){var t={userId:this.currentUser.userId,groupId:e.groupId};Le.post("/user/getUserRole",t,function(t){var r=t.data;0==r.code&&(Ae.dispatch("setUserRole",r.data),Ae.dispatch("setCurrentGroup",e))},function(e){v.error(e)})},handleCommand:function(e){"profile"==e&&this.toUserProfile()},toUserProfile:function(){this.$router.push({name:"profile",params:{userId:this.currentUser.userId}})},toDataOperation:function(){this.$router.push({name:"data-operation",params:{groupId:this.selectGroupId}})},toSystemOperation:function(){this.$router.push({name:"system-operation",params:{groupId:this.selectGroupId}})},handleOpen:function(e,t){},handleClose:function(e,t){},errorHandler:function(){return!0},collapseHandler:function(){this.isCollapse=!this.isCollapse},getGroupList:function(){var e=this,t=Ae.getters.getUser;Le.post("/group/getGroupList",t,function(t){if(0==t.data.code){var r=t.data.data;r.forEach(function(e){e.time=C(e.updateTime)}),Ae.dispatch("setGroupList",r);var a=e.currentGroup,s=Ae.getters.getUser;(o(a)||o(a.groupId))&&r.forEach(function(t){t.groupId==s.groupId&&(e.selectGroupId=s.groupId,Ae.dispatch("setCurrentGroup",t),e.getUserRole(t))})}else v.error("Get group list failed")},function(e){v.error(e)})},closeDialog:function(e){var t=this;this.active=!1,this.$nextTick(function(){return t.active=!0}),this.importVisible=e},getUserFromSession:function(){var e=this;Le.get("/user/getUserFromSession",null,function(t){var r=t.data;0==r.code?Ae.dispatch("setUser",r.data):e.signOut()},function(e){v.error("Auto get user failed.")})}},computed:{currentUser:function(){return Ae.getters.getUser},currentGroup:function(){return Ae.getters.getCurrentGroup},groupList:function(){return Ae.getters.getGroupList}},mounted:function(){this.getUserFromSession(),this.getGroupList();var e;e=o(this.currentGroup)||o(this.currentGroup.groupId)?this.currentUser.groupId:this.currentGroup.groupId,this.selectGroupId=e,"/"==this.$route.path&&this.toDashboard()},created:function(){var e,t,r,a,s,n;e=function(e){Ae.dispatch("setUserIp",e)},t=new(window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection)({iceServers:[]}),r=function(){},a={},s=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/g,n=function(t){a[t]||e(t),a[t]=!0},t.createDataChannel(""),t.createOffer().then(function(e){e.sdp.split("\n").forEach(function(e){e.indexOf("candidate")<0||e.match(s).forEach(n)}),t.setLocalDescription(e,r,r)}).catch(function(e){}),t.onicecandidate=function(e){e&&e.candidate&&e.candidate.candidate&&e.candidate.candidate.match(s)&&e.candidate.candidate.match(s).forEach(n)}}},N={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{attrs:{id:"index"}},[a("el-header",{staticClass:"header header-wrapper"},[a("div",{staticClass:"grid-content logo-wrapper"},[a("i",{staticClass:"el-icon-s-fold aside-operation",on:{click:e.collapseHandler}}),e._v(" "),a("img",{staticStyle:{width:"150px",height:"15px"},attrs:{src:r("nhBv")}})]),e._v(" "),a("div",{staticClass:"grid-content right-content",attrs:{id:"right-content"}},[a("el-select",{staticClass:"group-select",attrs:{placeholder:"Select Group",size:"mini"},on:{change:function(t){return e.selectGroup()}},model:{value:e.selectGroupId,callback:function(t){e.selectGroupId=t},expression:"selectGroupId"}},e._l(e.groupList,function(e){return a("el-option",{key:e.groupId,attrs:{label:e.groupName,value:e.groupId}})}),1),e._v(" "),e.permission?a("div",[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){e.importVisible=!0}}},[e._v("Import Cluster")])],1):e._e(),e._v(" "),a("div",{staticClass:"links",attrs:{id:"links"}},[a("el-divider",{attrs:{direction:"vertical"}}),e._v(" "),a("el-link",{attrs:{underline:!1,href:"https://github.com/ngbdf/redis-manager/",target:"_blank"}},[a("i",{staticClass:"el-icon-ali-git link-icon",attrs:{title:"Github"}})]),e._v(" "),a("el-divider",{attrs:{direction:"vertical"}}),e._v(" "),a("el-link",{attrs:{underline:!1,href:"https://github.com/ngbdf/redis-manager/wiki",target:"_blank"}},[a("i",{staticClass:"el-icon-tickets link-icon",attrs:{title:"Document"}})]),e._v(" "),a("el-divider",{attrs:{direction:"vertical"}}),e._v(" "),a("el-link",{attrs:{underline:!1,href:"https://github.com/ngbdf/redis-manager/issues/new",target:"_blank"}},[a("i",{staticClass:"el-icon-ali-feedback link-icon",attrs:{title:"Feedback"}})])],1),e._v(" "),a("div",{staticClass:"user-info"},[a("el-dropdown",{staticClass:"user-dropdown",on:{command:e.handleCommand}},[a("el-image",{attrs:{src:e.currentUser.avatar,fit:"cover"},on:{error:e.errorHandler}},[e._v(e._s(e.currentUser.userName))]),e._v(" "),a("el-dropdown-menu",{staticStyle:{"min-width":"180px"},attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{disabled:""}},[e._v("\n              Signed in as\n              "),a("b",[e._v(e._s(e.currentUser.userName))])]),e._v(" "),a("el-dropdown-item",{attrs:{command:"profile",divided:""}},[e._v("Profile")]),e._v(" "),a("el-dropdown-item",{attrs:{divided:""},nativeOn:{click:function(t){return e.signOut(t)}}},[e._v("Sign out")])],1)],1)],1)],1)]),e._v(" "),a("el-container",{staticClass:"aside-main-wrapper"},[a("el-aside",{class:{"is-collapse":e.isCollapse},staticStyle:{width:"200px"}},[a("el-row",[a("el-col",{attrs:{span:24}},[a("el-menu",{attrs:{"default-active":"1",collapse:e.isCollapse,"collapse-transition":!1,"background-color":"#2a3542","text-color":"#909399","active-text-color":"#fff"},on:{open:e.handleOpen,close:e.handleClose}},[a("el-menu-item",{attrs:{index:"1"},on:{click:function(t){return e.toDashboard()}}},[a("i",{staticClass:"el-icon-discover"}),e._v(" "),a("span",{attrs:{slot:"title"},slot:"title"},[e._v("Dashboard")])]),e._v(" "),e.currentUser.userRole<2?a("el-menu-item",{attrs:{index:"2"},on:{click:function(t){return e.toInstallation()}}},[a("i",{staticClass:"el-icon-setting"}),e._v(" "),a("span",{attrs:{slot:"title"},slot:"title"},[e._v("Installation")])]):e._e(),e._v(" "),e.currentUser.userRole<2?a("el-submenu",{attrs:{index:"3"}},[a("template",{slot:"title"},[a("i",{staticClass:"el-icon-bell"}),e._v(" "),a("span",[e._v("Alert Manage")])]),e._v(" "),a("el-menu-item-group",[a("el-menu-item",{attrs:{index:"3-1"},on:{click:function(t){return e.toChannelManage()}}},[e._v("Channel Manage")]),e._v(" "),a("el-menu-item",{attrs:{index:"3-2"},on:{click:function(t){return e.toRuleManage()}}},[e._v("Rule Manage")])],1)],2):e._e(),e._v(" "),e.currentUser.userRole<2?a("el-menu-item",{attrs:{index:"4"},on:{click:function(t){return e.toMachineManage()}}},[a("i",{staticClass:"el-icon-monitor"}),e._v(" "),a("span",{attrs:{slot:"title"},slot:"title"},[e._v("Machine Manage")])]):e._e(),e._v(" "),a("el-submenu",{attrs:{index:"5"}},[a("template",{slot:"title"},[a("i",{staticClass:"el-icon-takeaway-box"}),e._v(" "),a("span",[e._v("Tools")])]),e._v(" "),a("el-menu-item-group",[e.currentUser.userRole<2?a("el-menu-item",{attrs:{index:"5-1"},on:{click:function(t){return e.toDataOperation()}}},[e._v("Data Operation")]):e._e(),e._v(" "),e.currentUser.userRole<2?a("el-menu-item",{attrs:{index:"5-2"},on:{click:function(t){return e.toSystemOperation()}}},[e._v("System Operation")]):e._e()],1)],2),e._v(" "),e.currentUser.userRole<1?a("el-menu-item",{attrs:{index:"6"},on:{click:function(t){return e.toGroupManage()}}},[a("i",{staticClass:"el-icon-user-solid"}),e._v(" "),a("span",{attrs:{slot:"title"},slot:"title"},[e._v("Group Manage")])]):e._e(),e._v(" "),e.currentUser.userRole<2?a("el-menu-item",{attrs:{index:"7"},on:{click:function(t){return e.toUserManage()}}},[a("i",{staticClass:"el-icon-user"}),e._v(" "),a("span",{attrs:{slot:"title"},slot:"title"},[e._v("User Manage")])]):e._e(),e._v(" "),e.currentUser.userRole<2?a("el-menu-item",{attrs:{index:"8"},on:{click:function(t){return e.toEditHistory()}}},[a("i",{staticClass:"el-icon-edit"}),e._v(" "),a("span",{attrs:{slot:"title"},slot:"title"},[e._v("Edit History")])]):e._e()],1)],1)],1)],1),e._v(" "),a("el-main",{staticClass:"main",class:{"main-margin":e.isCollapse},staticStyle:{"margin-left":"200px"}},[a("transition",{attrs:{name:"fade",mode:"out-in"}},[e.active?a("router-view"):e._e()],1)],1)],1),e._v(" "),e.importVisible?a("el-dialog",{attrs:{title:"Import Cluster",visible:e.importVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.importVisible=t}}},[a("editCluster",{on:{closeDialog:e.closeDialog}})],1):e._e()],1)},staticRenderFns:[]},R=r("VU/8")(L,N,!1,function(e){r("fUwY")},null,null).exports,x=r("mvHQ"),S=r.n(x),A=r("gZhU");r("8U58"),r("4/hK"),r("5IAE"),r("jQeI"),r("PsxY"),r("Mixr"),r("gSgD");var P={components:{codemirror:A.codemirror},props:{cluster:{}},data:function(){return{dbList:[],autoCommandParam:{clusterId:this.cluster.clusterId,count:100},result:"",codemirrorOptions:{mode:"application/json",readOnly:!0,autoRefresh:!0,scrollbarStyle:"null",theme:"xq-light",lineNumbers:!0},queryLoading:!1}},methods:{getDBList:function(e){var t=this,r="/data/getDBList/"+e;Le.get(r,null,function(e){var r=e.data;0==r.code?r.data.forEach(function(e){var r=e.database;t.dbList.push({keys:e.keys,database:r.slice(2)})}):v.error(r.message)},function(e){v.error(e)})},queryRedis:function(e){var t=this;this.result="","cluster"==this.cluster.redisMode&&(e.database=0),o(e.database)?v.warning("Please select database"):o(e.key)?v.warning("Please enter redis key"):(this.queryLoading=!0,Le.post("/data/query",e,function(e){var r=e.data;if(0==r.code){var a=r.data,s={};s.ttl=a.ttl,s.type=a.type,s.value=a.value,t.result=S()(s,null,2)}else v.error(r.message);t.queryLoading=!1},function(e){t.queryLoading=!1,v.error(e)}))},scanRedis:function(e){var t=this;this.result="","cluster"==this.cluster.redisMode&&(e.database=0),o(e.database)?v.warning("Please select database"):(this.queryLoading=!0,Le.post("/data/scan",e,function(e){var r=e.data;0==r.code?r.data.forEach(function(e){t.result+=e+"\n"}):v.error(r.message),t.queryLoading=!1},function(e){t.queryLoading=!1,v.error(e)}))}},mounted:function(){this.getDBList(this.cluster.clusterId),"cluster"==this.cluster.redisMode&&(this.autoCommandParam.database="db0")}},U=r("VU/8")(P,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.queryLoading,expression:"queryLoading"}],staticClass:"query-wrapper",attrs:{id:"query"}},[r("div",{staticClass:"input-wrapper"},[r("el-input",{staticClass:"input-with-select",attrs:{size:"small",placeholder:"Redis Key",clearable:""},model:{value:e.autoCommandParam.key,callback:function(t){e.$set(e.autoCommandParam,"key","string"==typeof t?t.trim():t)},expression:"autoCommandParam.key"}},[r("el-select",{staticStyle:{width:"50px"},attrs:{slot:"prepend",placeholder:"Select DB"},slot:"prepend",model:{value:e.autoCommandParam.database,callback:function(t){e.$set(e.autoCommandParam,"database",t)},expression:"autoCommandParam.database"}},e._l(e.dbList,function(t){return r("el-option",{key:t.database,attrs:{label:"db"+t.database,value:t.database}},[r("span",{staticStyle:{float:"left"}},[e._v("db"+e._s(t.database))]),e._v(" "),r("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.keys))])])}),1)],1),e._v(" "),r("el-button",{staticStyle:{"margin-left":"20px"},attrs:{size:"small",type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.queryRedis(e.autoCommandParam)}}},[e._v("Query")]),e._v(" "),r("el-button",{attrs:{size:"small",icon:"el-icon-search"},on:{click:function(t){return e.scanRedis(e.autoCommandParam)}}},[e._v("Scan")])],1),e._v(" "),r("codemirror",{staticClass:"result-wrapper",attrs:{options:e.codemirrorOptions},model:{value:e.result,callback:function(t){e.result=t},expression:"result"}})],1)},staticRenderFns:[]},!1,function(e){r("nLbs")},"data-v-b55808ce",null).exports,V={components:{query:U,editCluster:I},data:function(){return{overview:{userNumber:0,healthNumber:0,badNumber:0,alertNumber:0},clusterList:[],cluster:{},queryVisible:!1,editClusterId:"",editClusterVisible:!1,deleteClusterVisible:!1,clusterListLoading:!1}},methods:{toMonitor:function(e){this.$router.push({name:"redis-monitor",params:{clusterId:e}})},toManage:function(e){this.$router.push({name:"redis-manage",params:{clusterId:e}})},toAlertManage:function(e){this.$router.push({name:"alert-manage",params:{clusterId:e}})},handleQuery:function(e){this.cluster=e,this.queryVisible=!0},getOverview:function(e){var t=this,r="/group/overview/"+e;o(e)||Le.get(r,null,function(e){var r=e.data;if(0==r.code){var a=r.data;t.overview.alertNumber=a.alertNumber,t.overview.userNumber=a.userNumber}else v.error("Get group overview failed")},function(e){v.error(e)})},getClusterList:function(e){var t=this,r="/cluster/getClusterList/"+e;this.clusterListLoading=!0,o(e)||Le.get(r,null,function(e){var r=e.data;if(0==r.code){var a=r.data,s=0,n=0;a.forEach(function(e){"HEALTH"==e.clusterState?s++:n++}),t.overview.healthNumber=s,t.overview.badNumber=n,t.clusterList=a}else v.error("Get cluster list failed");t.clusterListLoading=!1},function(e){t.clusterListLoading=!1,v.error(e)})},editCluster:function(e){this.editClusterId=e,this.editClusterVisible=!0},showDeleteCluster:function(e){var t=this;this.clusterList.forEach(function(r){r.clusterId==e&&(t.cluster=r,t.deleteClusterVisible=!0)})},deleteCluster:function(e){var t=this,r={clusterId:e,groupId:this.currentGroupId};Le.post("/cluster/deleteCluster",r,function(e){0==e.data.code?(t.cluster={},t.getClusterList(t.currentGroupId),t.deleteClusterVisible=!1):v.error("Delete cluster failed")},function(e){v.error(e)})},closeEditClusterDialog:function(e){this.editClusterVisible=e,this.getClusterList(this.currentGroupId)}},computed:{currentGroupId:function(){return Ae.getters.getCurrentGroup.groupId},currentUser:function(){return Ae.getters.getUser}},watch:{currentGroupId:function(e){this.getClusterList(e),this.getOverview(e),this.$router.push({name:"dashboard",params:{groupId:e}})}},mounted:function(){var e=this.currentGroupId;this.getClusterList(e),this.getOverview(e),this.userRole=Ae.getters.getUserRole}},E=r("VU/8")(V,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.clusterListLoading,expression:"clusterListLoading"}]},[r("el-row",{staticClass:"card-panel-group",attrs:{gutter:20}},[r("el-col",{attrs:{xl:6,lg:6,md:12,sm:12}},[r("div",{staticClass:"card-panel"},[r("div",{staticClass:"card-panel-icon-wrapper card-panel-icon-user"},[r("i",{staticClass:"el-icon-user"})]),e._v(" "),r("div",{staticClass:"card-panel-info-wrapper"},[r("div",{staticClass:"card-panel-info-key"},[e._v("User Number")]),e._v(" "),r("div",{staticClass:"card-panel-info-value"},[e._v(e._s(e.overview.userNumber))])])])]),e._v(" "),r("el-col",{attrs:{xl:6,lg:6,md:12,sm:12}},[r("div",{staticClass:"card-panel"},[r("div",{staticClass:"card-panel-icon-wrapper card-panel-icon-health"},[r("i",{staticClass:"el-icon-sunny"})]),e._v(" "),r("div",{staticClass:"card-panel-info-wrapper"},[r("div",{staticClass:"card-panel-info-key"},[e._v("Health Number")]),e._v(" "),r("div",{staticClass:"card-panel-info-value"},[e._v(e._s(e.overview.healthNumber))])])])]),e._v(" "),r("el-col",{attrs:{xl:6,lg:6,md:12,sm:12}},[r("div",{staticClass:"card-panel"},[r("div",{staticClass:"card-panel-icon-wrapper card-panel-icon-bad"},[r("i",{staticClass:"el-icon-heavy-rain"})]),e._v(" "),r("div",{staticClass:"card-panel-info-wrapper"},[r("div",{staticClass:"card-panel-info-key"},[e._v("Bad Number")]),e._v(" "),r("div",{staticClass:"card-panel-info-value"},[e._v(e._s(e.overview.badNumber))])])])]),e._v(" "),r("el-col",{attrs:{xl:6,lg:6,md:12,sm:12}},[r("div",{staticClass:"card-panel"},[r("div",{staticClass:"card-panel-icon-wrapper card-panel-icon-alert"},[r("i",{staticClass:"el-icon-bell"})]),e._v(" "),r("div",{staticClass:"card-panel-info-wrapper"},[r("div",{staticClass:"card-panel-info-key"},[e._v("Alert Number")]),e._v(" "),r("div",{staticClass:"card-panel-info-value"},[e._v(e._s(e.overview.alertNumber))])])])])],1),e._v(" "),r("el-row",{attrs:{gutter:20}},e._l(e.clusterList,function(t){return r("el-col",{key:t.clusterId,attrs:{xs:24,sm:12,md:12,lg:8,xl:6}},[r("el-card",{staticClass:"box-card",attrs:{shadow:"hover"}},[r("div",{staticClass:"box-card-title",attrs:{slot:"header"},slot:"header"},[r("span",[e._v(e._s(t.clusterName))]),e._v(" "),null!=t.redisPassword&&""!=t.redisPassword?r("i",{staticClass:"el-icon-lock health",staticStyle:{float:"right",padding:"3px 0"}}):e._e()]),e._v(" "),r("div",[r("div",{staticClass:"text item"},[e._v("\n            State:\n            "),"HEALTH"==t.clusterState?r("el-tag",{attrs:{size:"mini",type:"success"}},[e._v(e._s(t.clusterState))]):r("el-tag",{attrs:{size:"mini",type:"danger"}},[e._v(e._s(t.clusterState))])],1),e._v(" "),r("div",{staticClass:"text item"},[e._v("\n            Model:\n            "),r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.redisMode))])],1),e._v(" "),r("div",{staticClass:"text item"},[e._v("\n            Version:\n            "),r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.redisVersion))])],1),e._v(" "),r("div",{staticClass:"text item"},[e._v("\n            Master:\n            "),r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.clusterSize))])],1),e._v(" "),r("div",{staticClass:"text item"},[e._v("\n            Nodes:\n            "),r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.clusterKnownNodes))])],1),e._v(" "),r("div",{staticClass:"text item"},[e._v("\n            Total Momery:\n            "),r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.totalUsedMemory)+"MB")])],1),e._v(" "),"cluster"==t.redisMode?r("div",{staticClass:"text item"},[e._v("\n            Slots Assigned(ok/assigned):\n            "),r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.clusterSlotsOk)+"/"+e._s(t.clusterSlotsAssigned))])],1):e._e(),e._v(" "),"standalone"==t.redisMode?r("div",{staticClass:"text item"},[e._v("\n            DB Size:\n            "),r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.dbSize))])],1):e._e(),e._v(" "),r("div",{staticClass:"text item"},[e._v("\n            Environment:\n            "),0==t.installationEnvironment?r("el-tag",{attrs:{size:"mini"}},[e._v("Docker")]):1==t.installationEnvironment?r("el-tag",{attrs:{size:"mini"}},[e._v("Machine")]):3==t.installationEnvironment?r("el-tag",{attrs:{size:"mini"}},[e._v("Humpback")]):e._e()],1),e._v(" "),r("div",{staticClass:"text item"},[e._v("\n            From:\n            "),0==t.installationType?r("el-tag",{attrs:{size:"mini"}},[e._v("Redis Manager")]):r("el-tag",{attrs:{size:"mini"}},[e._v("Import")])],1)]),e._v(" "),r("div",{staticClass:"card-bottom"},[r("el-button",{attrs:{size:"mini",title:"Query",icon:"el-icon-search",circle:""},on:{click:function(r){return e.handleQuery(t)}}}),e._v(" "),r("el-button",{attrs:{size:"mini",title:"Monitor",type:"primary",icon:"el-icon-view",circle:""},on:{click:function(r){return e.toMonitor(t.clusterId)}}}),e._v(" "),e.currentUser.userRole<2?r("el-button",{attrs:{size:"mini",title:"Alert",type:"warning",icon:"el-icon-bell",circle:""},on:{click:function(r){return e.toAlertManage(t.clusterId)}}}):e._e(),e._v(" "),e.currentUser.userRole<2?r("el-button",{attrs:{size:"mini",title:"Manage",type:"danger",icon:"el-icon-setting",circle:""},on:{click:function(r){return e.toManage(t.clusterId)}}}):e._e(),e._v(" "),e.currentUser.userRole<2?r("el-dropdown",{staticClass:"more-operation",attrs:{trigger:"click"}},[r("el-button",{attrs:{size:"mini",title:"Edit or delete",type:"info",icon:"el-icon-more",circle:""}}),e._v(" "),r("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[r("el-dropdown-item",{staticClass:"edit",attrs:{icon:"el-icon-edit-outline"},nativeOn:{click:function(r){return e.editCluster(t.clusterId)}}},[e._v("Edit")]),e._v(" "),r("el-dropdown-item",{staticClass:"delete",attrs:{icon:"el-icon-delete"},nativeOn:{click:function(r){return e.showDeleteCluster(t.clusterId)}}},[e._v("Delete")])],1)],1):e._e()],1)])],1)}),1),e._v(" "),e.queryVisible?r("el-dialog",{attrs:{title:"Query "+e.cluster.clusterName,visible:e.queryVisible,"close-on-click-modal":!1,width:"50%"},on:{"update:visible":function(t){e.queryVisible=t}}},[r("query",{attrs:{cluster:e.cluster}})],1):e._e(),e._v(" "),e.editClusterVisible?r("el-dialog",{attrs:{title:"Edit Cluster",visible:e.editClusterVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.editClusterVisible=t}}},[r("editCluster",{attrs:{clusterId:e.editClusterId},on:{closeDialog:e.closeEditClusterDialog}})],1):e._e(),e._v(" "),r("el-dialog",{attrs:{title:"Delete Cluster",visible:e.deleteClusterVisible,width:"30%"},on:{"update:visible":function(t){e.deleteClusterVisible=t}}},[r("span",[e._v("\n      Are you sure to delete\n      "),r("b",[e._v(e._s(e.cluster.clusterName))]),e._v(" ?\n    ")]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.deleteCluster(e.cluster.clusterId)}}},[e._v("Delete")])],1)])],1)},staticRenderFns:[]},!1,function(e){r("oe5G")},"data-v-d221a9aa",null).exports,z=r("bOdI"),G=r.n(z),T=(r("P7ry"),r("uk2G")),M=r("Icdr");r("4UDB"),r("Oq2I"),r("miEh"),r("80cc");var D={props:{nodeInfoParam:{},infoItem:""},data:function(){return{echartsData:[],echartsItemDataxAxis:[],noNodeInfoData:!0,lineColor:["#3888fa","#FF005A","#ffb980","#40c9c6","#b6a2de","#d87a80","#34bfa3","#5ab1ef","#3888fa","#ffba00","#c9c0cb","#FF005A","#3888fa","#FF005A","#ffb980","#40c9c6"],areaStyleColor:["rgba(56, 136, 250, 0.1)","rgba(250, 0, 90, 0.1)","rgba(64, 201, 198, 0.1)","rgba(255, 185, 128, 0.1)"],monitorDataLoading:!1}},methods:{initCharts:function(e){this.buildEchartsData(e);var t=this.buildSeries(this.echartsData),r=T();if((new Date).getTime(),!o(this)){var a=document.getElementById(this.infoItem);if(!o(a)){var s=M.init(a);s.clear(),s=M.init(a);var n=this.infoItem;"used_memory"!=n&&"used_memory_rss"!=n&&"used_memory_overhead"!=n&&"used_memory_dataset"!=n||(n+="(MB)"),s.setOption({title:{text:n,left:35},legend:{type:"scroll",bottom:0},grid:{left:20,right:20,bottom:50,top:50,containLabel:!0},tooltip:{trigger:"axis",axisPointer:{type:"cross"},padding:[5,10],position:function(e,t,r,a,s){var n={top:-10};return n[["left","right"][+(e[0]<s.viewSize[0]/2)]]=5,n}},toolbox:{feature:{saveAsImage:{}}},xAxis:{data:this.echartsItemDataxAxis},yAxis:{axisTick:{show:!0}},series:t}),r.listenTo(document.getElementById(this.infoItem),function(e){setTimeout(function(){s.resize()},0)}),window.addEventListener("resize",function(){setTimeout(function(){s.resize()},0)})}}},getNodeInfoDataList:function(e){var t=this;this.monitorDataLoading=!0,Le.post("/monitor/getInfoItemMonitorData",e,function(e){var r=e.data;if(0==r.code){var a=r.data;t.noNodeInfoData=!1,t.initCharts(a)}else v.error("Get node info list failed");t.monitorDataLoading=!1},function(e){t.monitorDataLoading=!1,v.error(e)})},buildSeries:function(e){var t=e.length;if(0!=t){for(var r=[],a=0;a<t;a++){var s=this.lineColor[a%t],n=(this.areaStyleColor[a%t],e[a]);r.push({name:n.name,itemStyle:{normal:{color:s,lineStyle:{color:s,width:1.5}}},smooth:!0,type:"line",data:n.data,animationDuration:2800,animationEasing:"cubicInOut",symbol:"none"})}return r}},buildEchartsData:function(e){var t=this;this.echartsData=[],this.echartsItemDataxAxis=[];var r=this.infoItem;e.forEach(function(e){var a=e[0],s={name:a.node+" "+a.role.toLowerCase(),data:[]},n=0==t.echartsItemDataxAxis.length;e.forEach(function(e){var a,i,l,o,u,c;for(var d in n&&t.echartsItemDataxAxis.push((a=e.updateTime,l=(i=new Date(a)).getMonth()+1,o=i.getDate(),u=i.getHours(),c=i.getMinutes(),w(l)+"/"+w(o)+" "+w(u)+":"+w(c))),e)r.replace(/[^a-zA-Z]/g,"",/\s/g,"",/[0-9]/g,"").toLowerCase()==d.toLowerCase()&&s.data.push(e[d])}),t.echartsData.push(s)})}},watch:{nodeInfoParam:{handler:function(){var e=JSON.parse(S()(this.nodeInfoParam));e.infoItem=this.infoItem,this.getNodeInfoDataList(e)},deep:!0}}},$=r("VU/8")(D,{render:function(){var e=this.$createElement,t=this._self._c||e;return t("el-col",{directives:[{name:"loading",rawName:"v-loading",value:this.monitorDataLoading,expression:"monitorDataLoading"}],staticClass:"chart-item",attrs:{xl:12,lg:12,md:24,sm:24}},[t("el-card",{staticClass:"box-card",attrs:{shadow:"hover"}},[t("div",{staticClass:"chart",class:{"chart-no-data":this.noNodeInfoData},attrs:{id:this.infoItem}})])],1)},staticRenderFns:[]},!1,function(e){r("TMx1")},"data-v-eebba92a",null).exports;r("uk2G"),r("Icdr"),r("4UDB"),r("Oq2I"),r("miEh"),r("80cc");var O={components:{query:U,echartsItem:$},data:function(){var e;return e={queryVisible:!1,cluster:{},redisNodeList:[],slowLogRedisNodeList:[],timeTypeList:[{value:0,label:"Minute"},{value:1,label:"Hour"}],pickerOptions:{shortcuts:[{text:"Last 15 Min",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-9e5),e.$emit("pick",[r,t])}},{text:"Last 30 Min",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-18e5),e.$emit("pick",[r,t])}},{text:"Last 1 Hour",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-36e5),e.$emit("pick",[r,t])}},{text:"Last 3 Hours",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-108e5),e.$emit("pick",[r,t])}},{text:"Last 6 Hours",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-216e5),e.$emit("pick",[r,t])}},{text:"Last 12 Hours",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-432e5),e.$emit("pick",[r,t])}},{text:"Last 1 Day",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-864e5),e.$emit("pick",[r,t])}},{text:"Last 2 Days",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-1728e5),e.$emit("pick",[r,t])}},{text:"Last 3 Days",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-2592e5),e.$emit("pick",[r,t])}},{text:"Last Week",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-6048e5),e.$emit("pick",[r,t])}},{text:"Last Mooth",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-2592e6),e.$emit("pick",[r,t])}}]},infoItemList:["used_memory","used_memory_rss","used_memory_overhead","used_memory_dataset","mem_fragmentation_ratio","connections_received","rejected_connections","connected_clients","blocked_clients","commands_processed","instantaneous_ops_per_sec","sync_full","sync_partial_ok","sync_partial_err","keyspace_hits_ratio","keys","expires","cpu_sys","cpu_user"],selectedInfoItemList:["used_memory","used_memory_rss","mem_fragmentation_ratio","connected_clients","commands_processed","instantaneous_ops_per_sec","keyspace_hits_ratio","keys","expires"],nodeInfoParam:{nodeList:[],timeType:0,timeRange:[new Date-9e5,new Date]},nodeType:"",nodes:[],slowLogVisible:!1,slowLogList:[],timer:0,slowLogParam:{}},G()(e,"slowLogList",[]),G()(e,"clusterLoading",!1),G()(e,"slowLogLoading",!1),G()(e,"conditionSelectedLoading",!1),e},methods:{handleQuery:function(e){this.queryVisible=!0},pickerDateTime:function(){var e=this.nodeInfoParam.timeRange,t=e[0],r=e[1];this.nodeInfoParam.startTime=t,this.nodeInfoParam.endTime=r},getAllNodeList:function(e){var t=this,r="/node-manage/getAllNodeList/"+e;this.slowLogRedisNodeList.push({label:"All"}),Le.get(r,null,function(e){var r=e.data;if(0==r.code){var a=[];r.data.forEach(function(e){var r=e.host+":"+e.port,s=e.nodeRole.toLowerCase(),n={node:r,role:s,value:r,label:r+" "+s};a.push(n),t.slowLogRedisNodeList.push(n)}),t.redisNodeList=a,t.nodeType="ALL_MASTER"}else v.error(r.message)},function(e){v.error(e)})},timedRefresh:function(){var e=this;this.timer?clearInterval(this.timer):this.timer=setInterval(function(){e.refresh()},3e5)},refresh:function(){var e=this.nodeInfoParam,t=e.timeRange,r=t[1]-t[0];e.timeRange=[new Date-r,new Date],e.startTime=new Date-r,e.endTime=new Date,this.nodeInfoParam=e},getSlowLogList:function(e){var t=this;this.slowLogLoading=!0,Le.post("/monitor/getSlowLogList",e,function(e){var r=e.data;if(0==r.code){var a=r.data;a.forEach(function(e){e.dateTime=C(e.dateTime)}),t.slowLogList=a}else v.error(r.message);t.slowLogLoading=!1},function(e){t.slowLogLoading=!1,v.error(e)})},monitorItemChange:function(e){var t=this;setTimeout(function(){t.refresh()},300)}},watch:{nodes:{handler:function(){var e=this.nodeInfoParam,t=[];this.nodes.length>0&&(this.nodes.forEach(function(e){t.push(e)}),e.nodeList=t,this.nodeInfoParam=e)}},nodeType:{handler:function(){if("NODE"!=this.nodeType){var e=this.nodeInfoParam,t=[];"ALL_MASTER"==this.nodeType&&this.redisNodeList.forEach(function(e){"master"==e.role&&t.push(e.node)}),"ALL_MASTER"!=this.nodeType&&"ALL"!=this.nodeType||(this.nodes=[]),e.nodeList=t,this.nodeInfoParam=e}else this.nodes=[]}},slowLogParam:{handler:function(){this.getSlowLogList(this.slowLogParam)},deep:!0}},mounted:function(){var e=this,t=this.$route.params.clusterId;y(t,function(r){if(e.cluster=r,parseInt(r.redisVersion.substring(0))<4)for(var a=0;a<e.selectedInfoItemList.length;a++){var s=e.selectedInfoItemList[a];"used_memory_overhead"!=s&&"used_memory_dataset"!=s||e.selectedInfoItemList.splice(a,a)}e.getAllNodeList(e.cluster.clusterId),e.nodeInfoParam.clusterId=t,e.slowLogParam.clusterId=t,e.pickerDateTime(),e.timedRefresh()})},destroyed:function(){clearInterval(this.timer)}},q=r("VU/8")(O,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"monitor"}},[r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.clusterLoading,expression:"clusterLoading"}],staticClass:"body-wrapper"},[r("el-row",[r("el-col",{attrs:{span:24}},[r("div",{staticClass:"monitor-title"},[r("span",[r("span",{staticClass:"cluster-name"},[e._v(e._s(e.cluster.clusterName))]),e._v(" "),"HEALTH"==e.cluster.clusterState?r("i",{staticClass:"el-icon-sunny health"}):r("i",{staticClass:"el-icon-heavy-rain bad",attrs:{title:"Status"}})]),e._v(" "),r("div",[r("el-button",{attrs:{size:"mini",type:"primary",title:"Query",icon:"el-icon-search"},on:{click:function(t){return e.handleQuery(e.cluster.clusterId)}}},[e._v("Query")]),e._v(" "),r("el-button",{attrs:{size:"mini",type:"warning",icon:"el-icon-ali-slow",title:"Slow log"},on:{click:function(t){e.slowLogVisible=!0}}},[e._v("Slow Log")])],1)])])],1),e._v(" "),r("div",{staticClass:"base-info-wrapper"},[r("el-row",{staticClass:"base-info"},[r("el-col",{attrs:{xl:3,lg:4,md:6,sm:8}},[r("div",{staticClass:"base-info-item"},[e._v("\n            Mode:\n            "),r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.cluster.redisMode))])],1)]),e._v(" "),r("el-col",{attrs:{xl:3,lg:4,md:6,sm:8}},[r("div",{staticClass:"base-info-item"},[e._v("\n            Version:\n            "),r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.cluster.redisVersion))])],1)]),e._v(" "),r("el-col",{attrs:{xl:3,lg:4,md:6,sm:8}},[r("div",{staticClass:"base-info-item"},[e._v("\n            Master:\n            "),r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.cluster.clusterSize))])],1)]),e._v(" "),r("el-col",{attrs:{xl:3,lg:4,md:6,sm:8}},[r("div",{staticClass:"base-info-item"},[e._v("\n            Node:\n            "),r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.cluster.clusterKnownNodes))])],1)]),e._v(" "),r("el-col",{attrs:{xl:3,lg:4,md:6,sm:8}},[r("div",{staticClass:"base-info-item"},[e._v("\n            Total Memory:\n            "),r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.cluster.totalUsedMemory)+"MB")])],1)]),e._v(" "),r("el-col",{attrs:{xl:3,lg:4,md:6,sm:8}},[r("div",{staticClass:"base-info-item"},[e._v("\n            Total Keys:\n            "),r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.cluster.totalKeys))])],1)]),e._v(" "),r("el-col",{attrs:{xl:3,lg:4,md:6,sm:8}},[r("div",{staticClass:"base-info-item"},[e._v("\n            Total Expires:\n            "),r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.cluster.totalExpires))])],1)])],1)],1)],1),e._v(" "),r("div",{staticStyle:{"margin-top":"20px"}},[r("div",{staticClass:"monitor-condition-wrapper"},[r("div",{staticClass:"condition-wrapper"},[r("el-select",{staticClass:"condition-item",staticStyle:{width:"120px"},attrs:{size:"small",placeholder:"Node Type"},model:{value:e.nodeType,callback:function(t){e.nodeType=t},expression:"nodeType"}},[r("el-option",{attrs:{label:"All Master",value:"ALL_MASTER"}}),e._v(" "),r("el-option",{attrs:{label:"All",value:"ALL"}}),e._v(" "),r("el-option",{attrs:{label:"Node",value:"NODE"}})],1),e._v(" "),"NODE"==e.nodeType?r("el-select",{staticClass:"condition-item",staticStyle:{"min-width":"280px"},attrs:{filterable:"",size:"small",placeholder:"Node",multiple:"","collapse-tags":"",clearable:""},model:{value:e.nodes,callback:function(t){e.nodes=t},expression:"nodes"}},e._l(e.redisNodeList,function(e){return r("el-option",{key:e.label,attrs:{label:e.label,value:e.value}})}),1):e._e(),e._v(" "),r("el-select",{staticClass:"condition-item",staticStyle:{width:"100px"},attrs:{size:"small",placeholder:"Time Type"},model:{value:e.nodeInfoParam.timeType,callback:function(t){e.$set(e.nodeInfoParam,"timeType",t)},expression:"nodeInfoParam.timeType"}},e._l(e.timeTypeList,function(e){return r("el-option",{key:e.label,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),r("el-select",{staticClass:"condition-item",staticStyle:{width:"260px"},attrs:{size:"small",placeholder:"Info Item",multiple:"","collapse-tags":""},on:{change:e.monitorItemChange},model:{value:e.selectedInfoItemList,callback:function(t){e.selectedInfoItemList=t},expression:"selectedInfoItemList"}},e._l(e.infoItemList,function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})}),1),e._v(" "),r("div",{staticClass:"time-picker-wrapper"},[r("el-date-picker",{attrs:{width:"1080px",size:"small",type:"datetimerange","picker-options":e.pickerOptions,"range-separator":"-","start-placeholder":"Start Time","end-placeholder":"End Time",align:"right",editable:!1,"value-format":"timestamp"},on:{change:e.pickerDateTime},model:{value:e.nodeInfoParam.timeRange,callback:function(t){e.$set(e.nodeInfoParam,"timeRange",t)},expression:"nodeInfoParam.timeRange"}})],1)],1),e._v(" "),r("i",{staticClass:"el-icon-refresh-left refresh",on:{click:function(t){return e.refresh()}}})]),e._v(" "),r("el-row",{staticClass:"echart-wrapper",attrs:{id:"monitor-charts"}},e._l(e.selectedInfoItemList,function(t){return r("echartsItem",{key:t,attrs:{infoItem:t,nodeInfoParam:e.nodeInfoParam}})}),1)],1),e._v(" "),r("el-dialog",{attrs:{title:"Query",visible:e.queryVisible,"close-on-click-modal":!1,width:"60%"},on:{"update:visible":function(t){e.queryVisible=t}}},[r("query",{attrs:{cluster:e.cluster}})],1),e._v(" "),r("el-dialog",{attrs:{title:"Slow Log",visible:e.slowLogVisible,"close-on-click-modal":!1,width:"80%"},on:{"update:visible":function(t){e.slowLogVisible=t}}},[r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.slowLogLoading,expression:"slowLogLoading"}]},[r("el-select",{staticClass:"condition-item",staticStyle:{"margin-bottom":"20px"},attrs:{filterable:"",size:"small",placeholder:"Please select node"},model:{value:e.slowLogParam.node,callback:function(t){e.$set(e.slowLogParam,"node",t)},expression:"slowLogParam.node"}},e._l(e.slowLogRedisNodeList,function(e){return r("el-option",{key:e.label,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),r("el-table",{attrs:{data:e.slowLogList,"default-sort":{prop:"dateTime",order:"descending"}}},[r("el-table-column",{attrs:{type:"index",width:"50"}}),e._v(" "),r("el-table-column",{attrs:{prop:"node",label:"Node",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{prop:"type",label:"Type"}}),e._v(" "),r("el-table-column",{attrs:{prop:"command",label:"Command"}}),e._v(" "),r("el-table-column",{attrs:{prop:"executionTime",label:"Execution Time(μs)",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{prop:"dateTime",label:"Date Time",sortable:""}})],1)],1)])],1)},staticRenderFns:[]},!1,function(e){r("DQH3")},"data-v-05837c50",null).exports,F=r("RRo+"),H=r.n(F),B={props:{redisNode:{}},data:function(){return{infoList:[],search:""}},methods:{getNodeInfo:function(){var e=this;Le.post("/node-manage/getNodeInfo",this.redisNode,function(t){var r=t.data;0==r.code?e.infoList=r.data:v.error("Get node info failed")},function(e){v.error(e)})}},computed:{filterInfoList:function(){var e=this;return this.infoList.filter(function(t){return!e.search||t.key.toLowerCase().includes(e.search.toLowerCase())})}},mounted:function(){this.getNodeInfo()}},K={props:{redisNode:{}},data:function(){return{configList:[],search:""}},methods:{getConfig:function(){var e=this;Le.post("/node-manage/getConfig",this.redisNode,function(t){var r=t.data;0==r.code?e.configList=r.data:v.error("get node config failed")},function(e){v.error(e)})}},computed:{filterConfigList:function(){var e=this;return this.configList.filter(function(t){return!e.search||t.key.toLowerCase().includes(e.search.toLowerCase())})}},mounted:function(){this.getConfig()}},W={components:{info:r("VU/8")(B,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"info-wrapper"},[r("el-input",{staticStyle:{"margin-bottom":"20px"},attrs:{size:"mini",placeholder:"search"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),e._v(" "),e._l(e.filterInfoList,function(t){return r("div",{key:t.key,staticClass:"info-item"},[null!=t.description?r("div",{staticClass:"description"},[e._v("# "+e._s(t.description))]):e._e(),e._v(" "),r("span",[r("span",{staticClass:"key"},[e._v(e._s(t.key)+":")]),e._v(" "),r("span",{staticClass:"value"},[e._v(e._s(t.value))])])])})],2)},staticRenderFns:[]},!1,function(e){r("V3UU")},"data-v-6d9c90c5",null).exports,config:r("VU/8")(K,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"config-wrapper"},[r("el-input",{staticStyle:{"margin-bottom":"20px"},attrs:{size:"mini",placeholder:"search"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),e._v(" "),e._l(e.filterConfigList,function(t){return r("div",{key:t.key,staticClass:"config-item"},[null!=t.description&&""!=t.description?r("div",{staticClass:"description"},[e._v("# "+e._s(t.description))]):e._e(),e._v(" "),r("span",[r("span",{staticClass:"key"},[e._v(e._s(t.key)+":")]),e._v(" "),r("span",{staticClass:"value"},[e._v(e._s(t.value))])])])})],2)},staticRenderFns:[]},!1,function(e){r("Kuh7")},"data-v-4a923cae",null).exports},data:function(){var e=this,t=function(e,t,r){H()(t)?(t<0||t>16383)&&r(new Error("Slot range between 0 and 16383")):r(new Error("Please enter number")),r()};return{cluster:{},search:"",redisNodeList:[],replicateOfVisible:!1,failOverVisible:!1,importNodeVisible:!1,editConfigVisible:!1,forgetVisible:!1,moveSlotVisible:!1,startNodeVisible:!1,stopNodeVisible:!1,restartNodeVisible:!1,deleteNodeVisible:!1,infoVisible:!1,configVisible:!1,initSlotsVisible:!1,slotRange:{},operationNode:{},operationNodeList:[],newRedisNode:{},configKeyList:[],redisConfig:{},nodeConfigList:[],rules:{redisNode:[{required:!0,message:"Please enter redis node",trigger:"blur"},{required:!0,validator:function(e,t,r){if(!d(t))return r(new Error("Incorrect format"));r()},trigger:"blur"},{required:!0,validator:function(t,r,a){var s={redisPassword:e.cluster.redisPassword},n=r.split(":"),i={host:n[0],port:n[1]};s.redisNode=i,Le.post("/validate/redisNode",s,function(e){if(0!=e.data.code)return a(new Error("Connection refused."));a()},function(e){return a(new Error("Network error, "+e))})},trigger:"blur"}],startSlot:[{required:!0,message:"Please enter slot",trigger:"blur"},{required:!0,validator:t,trigger:"blur"}],endSlot:[{required:!0,message:"Please enter slot",trigger:"blur"},{required:!0,validator:t,trigger:"blur"},{required:!0,validator:function(t,r,a){var s=e.slotRange.startSlot;o(s)&&a(),r-s<0&&a(new Error("End slot must be greater than the start slot")),a()},trigger:"blur"}],configKey:[{required:!0,message:"Please select or enter config key",trigger:"blur"}]},clusterLoading:!1,nodeListLoading:!1,operationLoading:!1}},methods:{tableRowClassName:function(e){var t=e.row;return e.rowIndex,"MASTER"==t.nodeRole?"info-row":""},handleSelectionChange:function(e){var t=this;this.operationNode=[],e.forEach(function(e){t.operationNode.push(e)})},getAllNodeList:function(e){var t=this;this.nodeListLoading=!0;var r="/node-manage/getAllNodeListWithStatus/"+e;Le.get(r,null,function(e){var r=e.data;if(0==r.code){var a=[],s=void 0,n=[];r.data.forEach(function(e){o(e.nodeId)&&(e.nodeId=e.host+":"+e.port);var t=e.flags;e.time=C(e.updateTime),"master"==t?(n=[],(s=e).children=n,a.push(s)):"slave"==t||"replica"==t?e.runStatus?n.push(e):(e.children=[],a.push(e)):a.push(e)}),a.forEach(function(e){var t=e.children,r=0;o(t)||o(t.length)||(r=t.length),e.replicaNumber=r}),t.redisNodeList=a}else v.error(r.message);t.nodeListLoading=!1},function(e){t.nodeListLoading=!1,v.error(e)})},reload:function(){var e=this,t=this.cluster.clusterId;this.getAllNodeList(t),y(t,function(r){e.cluster=r,e.getAllNodeList(t),e.getConfigKeyList()}),this.updateCluster(this.clsuter)},updateCluster:function(e){var t=this;Le.post("/cluster/updateCluster",this.cluster,function(e){var r=e.data;0==r.code?t.cluster=r.data:v.error(r.message)},function(e){v.error(e)})},getNodeInfo:function(e){this.operationNode=e,this.infoVisible=!0},getConfig:function(e){this.operationNode=e,this.configVisible=!0},getConfigKeyList:function(){var e=this;Le.get("/node-manage/getRedisConfigKeyList",null,function(t){e.configKeyList=t.data.data},function(e){v.error(e)})},getConfigCurrentValue:function(e){var t=this,r={cluster:this.cluster,configKey:e.configKey};Le.post("/node-manage/getConfigCurrentValue",r,function(e){t.nodeConfigList=e.data.data},function(e){v.error(e)})},editConfig:function(e){var t=this;this.$refs[e].validate(function(e){if(e){var r={clusterId:t.cluster.clusterId,redisConfig:t.redisConfig,groupId:t.currentGroup.groupId};Le.post("/node-manage/updateRedisConfig",r,function(e){0==e.data.code?t.editConfigVisible=!1:v.error("update config failed")},function(e){v.error(e)})}})},canOperate:function(){if(this.nodeNumber<=1)return!0;var e=this.cluster.nodes,t=e.split(",");return this.operationNodeList.forEach(function(r){var a=r.host+":"+r.port;if(e.indexOf(a)>-1&&1==t.length)return v.warning("I can't operate "+a+", because it in the database"),!1}),!0},buildNodeList:function(e){var t=!o(e.length);this.operationNodeList=[],t||(this.operationNode={},this.operationNode=e,this.operationNode.groupId=this.currentGroup.groupId,this.operationNodeList.push(this.operationNode))},handleReplicateOf:function(e){this.replicateOfVisible=!0,this.buildNodeList(e)},replicateOf:function(e){var t=this;if(o(e))v.error("Node invalid");else{this.operationNodeList.forEach(function(t){t.masterId=e});var r=this.cluster.redisMode,a=void 0;if("cluster"==r)a="/node-manage/replicateOf";else{if("standalone"!=r)return;a="/node-manage/standaloneReplicateOf"}Le.post(a,this.operationNodeList,function(e){var r=e.data;t.reload(),0==r.code?t.replicateOfVisible=!1:v.error(r.message)},function(e){v.error(e)})}},handleFailOver:function(e){this.failOverVisible=!0,this.buildNodeList(e)},failOver:function(){var e=this;Le.post("/node-manage/failOver",this.operationNodeList,function(t){var r=t.data;e.getAllNodeList(e.cluster.clusterId),0==r.code?e.failOverVisible=!1:v.error(r.message)},function(e){v.error(e)})},importNode:function(e){var t=this;this.$refs[e].validate(function(e){if(e){var r=t.newRedisNode.address.split(":"),a={clusterId:t.cluster.clusterId,host:r[0],port:r[1],groupId:t.currentGroup.groupId},s=[];s.push(a),Le.post("/node-manage/importNode",s,function(e){var r=e.data;t.reload(),0==r.code?t.importNodeVisible=!1:v.error(r.message)},function(e){v.error(e)})}})},handleForget:function(e){this.forgetVisible=!0,this.buildNodeList(e)},forget:function(){var e=this,t=this.cluster.redisMode,r=void 0;if("cluster"==t)r="/node-manage/forget";else{if("standalone"!=t)return;r="/node-manage/standaloneForget"}this.canOperate()&&Le.post(r,this.operationNodeList,function(t){var r=t.data;e.reload(),0==r.code?e.forgetVisible=!1:v.error(r.message)},function(e){v.error(e)})},handleMoveSlot:function(e){this.moveSlotVisible=!0,this.buildNodeList(e)},moveSlot:function(e){var t=this;this.$refs[e].validate(function(r){if(r){var a={redisNode:t.operationNode,slotRange:t.slotRange,groupId:t.currentGroup.groupId};Le.post("/node-manage/moveSlot",a,function(r){var a=r.data;t.getAllNodeList(t.cluster.clusterId),0==a.code?(t.moveSlotVisible=!1,t.$refs[e].resetFields()):v.error(a.message+" Move slot failed")},function(e){v.error(e)})}})},handleStart:function(e){e.runStatus?v.error("This node is already running"):(this.buildNodeList(e),this.startNodeVisible=!0)},startNode:function(){var e=this;Le.post("/node-manage/start",this.operationNodeList,function(t){var r=t.data;e.reload(),0==r.code?e.startNodeVisible=!1:v.error("start node failed")},function(e){v.error(e)})},handleStop:function(e){e.inCluster,e.runStatus?(this.buildNodeList(e),this.stopNodeVisible=!0):v.error("This node has stopped")},stopNode:function(){var e=this;this.canOperate&&Le.post("/node-manage/stop",this.operationNodeList,function(t){var r=t.data;e.reload(),0==r.code?e.stopNodeVisible=!1:v.error("stop node failed")},function(e){v.error(e)})},handleRestart:function(e){this.buildNodeList(e),this.restartNodeVisible=!0},restartNode:function(){var e=this;this.canOperate&&Le.post("/node-manage/restart",this.operationNodeList,function(t){var r=t.data;e.reload(),0==r.code?e.restartNodeVisible=!1:v.error("restart node failed")},function(e){v.error(e)})},handleDelete:function(e){var t=e.inCluster,r=e.runStatus;t?v.error(e.host+":"+e.port+" still in the cluster, please forget it first"):r?v.error(e.host+":"+e.port+" is running, please stop it first"):(this.buildNodeList(e),this.deleteNodeVisible=!0)},deleteNode:function(){var e=this;this.canOperate&&Le.post("/node-manage/delete",this.operationNodeList,function(t){var r=t.data;e.reload(),0==r.code?e.deleteNodeVisible=!1:v.error("delete node failed")},function(e){v.error(e)})},initSlots:function(){var e=this;Le.post("/node-manage/initSlots",this.cluster,function(t){var r=t.data;e.reload(),0==r.code?e.initSlotsVisible=!1:v.error(r.message)},function(e){v.error(e)})},refresh:function(){var e=this,t=this.cluster.clusterId;y(t,function(r){e.cluster=r,e.getAllNodeList(t)})}},computed:{nodeNumber:function(){var e=0;return this.redisNodeList.forEach(function(t){e+=1;var r=t.children;o(r)||o(r.length)||(e+=r.length)}),e},currentGroup:function(){return Ae.getters.getCurrentGroup}},watch:{currentGroup:function(e){this.$router.push({name:"dashboard",params:{groupId:e.groupId}})}},mounted:function(){var e=this,t=this.$route.params.clusterId;y(t,function(r){e.cluster=r,e.getAllNodeList(t),e.getConfigKeyList()})}},j=r("VU/8")(W,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"body-wrapper",attrs:{id:"cluster-manage"}},[r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.clusterLoading,expression:"clusterLoading"}],staticClass:"manage-header-wrapper"},[r("div",{staticClass:"title-wrapper"},[r("span",[e._v(e._s(e.cluster.clusterName))]),e._v(" "),"HEALTH"==e.cluster.clusterState?r("i",{staticClass:"el-icon-sunny health",attrs:{title:"Status"}}):r("i",{staticClass:"el-icon-heavy-rain bad",attrs:{title:"Status"}})]),e._v(" "),r("div",{staticClass:"base-info-operation-wrapper"},[r("span",{staticClass:"base-info-item"},[e._v("\n        Master:\n        "),r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.cluster.clusterSize))])],1),e._v(" "),r("span",{staticClass:"base-info-item"},[e._v("\n        Node:\n        "),r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.cluster.clusterKnownNodes))])],1),e._v(" "),r("span",{staticClass:"base-info-item"},[e._v("\n        Environment:\n        "),0==e.cluster.installationEnvironment?r("el-tag",{attrs:{size:"mini"}},[e._v("Docker")]):1==e.cluster.installationEnvironment?r("el-tag",{attrs:{size:"mini"}},[e._v("Machine")]):3==e.cluster.installationEnvironment?r("el-tag",{attrs:{size:"mini"}},[e._v("Humpback")]):e._e()],1),e._v(" "),null!=e.cluster.image&&""!=e.cluster.image?r("span",{staticClass:"base-info-item"},[e._v("\n        Image:\n        "),r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.cluster.image))])],1):e._e(),e._v(" "),r("span",{staticClass:"base-info-item"},[e._v("\n        Type:\n        "),0==e.cluster.installationType?r("el-tag",{attrs:{size:"mini"}},[e._v("Redis Manager")]):r("el-tag",{attrs:{size:"mini"}},[e._v("Import")])],1)])]),e._v(" "),r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.nodeListLoading,expression:"nodeListLoading"}],staticClass:"nodes-wrapper"},[r("div",{staticClass:"batch-operation-wrapper"},[r("div",{staticClass:"batch-title"},[e._v("Batch Operation")]),e._v(" "),r("div",{staticStyle:{display:"flex","justify-content":"space-between"}},[r("div",[r("el-link",{attrs:{underline:!1,icon:"el-icon-edit"},on:{click:function(t){e.editConfigVisible=!0}}},[e._v("Edit Config")]),e._v(" "),"cluster"!=e.cluster.redisMode||e.cluster.initialized||0!=e.cluster.clusterSlotsAssigned?e._e():r("span",[r("el-divider",{attrs:{direction:"vertical"}}),e._v(" "),r("el-link",{attrs:{underline:!1,icon:"el-icon-coordinate"},on:{click:function(t){e.initSlotsVisible=!0}}},[e._v("Init Slot")])],1)],1),e._v(" "),r("div",{staticStyle:{display:"flex","align-items":"center"}},[r("el-link",{attrs:{underline:!1,icon:"el-icon-plus",type:"primary"},on:{click:function(t){e.importNodeVisible=!0}}},[e._v("Import Node")]),e._v(" "),r("el-divider",{attrs:{direction:"vertical"}}),e._v(" "),r("i",{staticClass:"el-icon-refresh-left refresh",on:{click:function(t){return e.refresh()}}})],1)])]),e._v(" "),r("div",{staticClass:"table-wrapper"},[r("el-table",{staticStyle:{width:"100%","margin-bottom":"10px"},attrs:{data:e.redisNodeList,"row-key":"nodeId",size:"medium","default-sort":{prop:"slotRange",order:"ascending"},"row-class-name":e.tableRowClassName,"tree-props":{children:"children",hasChildren:"hasChildren"},"default-expand-all":!0}},[r("el-table-column",{attrs:{label:"Link State",sortable:"",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n            "+e._s(t.row.slot)+"\n            "),"connected"==t.row.linkState?r("el-tag",{attrs:{size:"mini",type:"success"}},[e._v(e._s(t.row.linkState))]):r("el-tag",{staticClass:"pointer",attrs:{size:"small",type:"warning"}},[e._v(e._s(t.row.linkState))])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"Flags",width:"90px"},scopedSlots:e._u([{key:"default",fn:function(t){return["master"==t.row.flags?r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.row.flags)+" ["+e._s(t.row.replicaNumber)+"]")]):r("el-tag",{staticClass:"pointer",attrs:{size:"mini",type:"info"}},[e._v(e._s(t.row.flags))])]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"inCluster",label:"In Cluster",align:"center",sortable:""},scopedSlots:e._u([{key:"default",fn:function(e){return[e.row.inCluster?r("i",{staticClass:"el-icon-success status-icon normal-status"}):r("i",{staticClass:"el-icon-error status-icon normal-bad"})]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"runStatus",label:"Run Status",align:"center",sortable:""},scopedSlots:e._u([{key:"default",fn:function(e){return[e.row.runStatus?r("i",{staticClass:"el-icon-success status-icon normal-status"}):r("i",{staticClass:"el-icon-error status-icon normal-bad"})]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"host",label:"Host",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{prop:"port",label:"Port",sortable:""}}),e._v(" "),"cluster"==e.cluster.redisMode?r("el-table-column",{attrs:{prop:"slotRange",label:"Slot Range",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n            "+e._s(t.row.slotRange)+"\n            "),null!=t.row.slotRange?r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.row.slotNumber))]):e._e()]}}],null,!1,865138624)}):e._e(),e._v(" "),r("el-table-column",{attrs:{label:"Meta",width:"130px;"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-tag",{staticClass:"pointer",attrs:{size:"mini"},on:{click:function(r){return e.getNodeInfo(t.row)}}},[e._v("Info")]),e._v(" "),r("el-tag",{staticClass:"pointer",attrs:{size:"mini"},on:{click:function(r){return e.getConfig(t.row)}}},[e._v("Config")])]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"time",label:"Time",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"Operation",width:"230px"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-dropdown",{attrs:{size:"mini","split-button":"",type:"warning",trigger:"click"}},[e._v("\n              Cluster\n              "),r("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},["cluster"==e.cluster.redisMode&&"MASTER"==t.row.nodeRole&&t.row.inCluster?r("el-dropdown-item",{nativeOn:{click:function(r){return e.handleMoveSlot(t.row)}}},[e._v("Move Slot")]):e._e(),e._v(" "),"SLAVE"==t.row.nodeRole||"REPLICA"==t.row.nodeRole||"MASTER"==t.row.nodeRole&&0==t.row.children.length?r("el-dropdown-item",{nativeOn:{click:function(r){return e.handleForget(t.row)}}},[e._v("Forget")]):e._e(),e._v(" "),"cluster"==e.cluster.redisMode&&t.row.inCluster&&("SLAVE"==t.row.nodeRole||"REPLICA"==t.row.nodeRole||"MASTER"==t.row.nodeRole&&null==t.row.slotRange)||"standalone"==e.cluster.redisMode&&!t.row.inCluster?r("el-dropdown-item",{nativeOn:{click:function(r){return e.handleReplicateOf(t.row)}}},[e._v("Replicate Of")]):e._e(),e._v(" "),"cluster"!=e.cluster.redisMode||"SLAVE"!=t.row.nodeRole&&"REPLICA"!=t.row.nodeRole||!t.row.inCluster?e._e():r("el-dropdown-item",{nativeOn:{click:function(r){return e.handleFailOver(t.row)}}},[e._v("Fail Over")]),e._v(" "),r("el-dropdown-item",[e._v("Memory Purge")])],1)],1),e._v(" "),r("el-dropdown",{attrs:{size:"mini","split-button":"",type:"danger",trigger:"click"}},[e._v("\n              Node\n              "),r("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[r("el-dropdown-item",{attrs:{disabled:t.row.runStatus},nativeOn:{click:function(r){return e.handleStart(t.row)}}},[e._v("Start")]),e._v(" "),r("el-dropdown-item",{attrs:{disabled:(t.row.inCluster||!t.row.runStatus)&&e.nodeNumber>1},nativeOn:{click:function(r){return e.handleStop(t.row)}}},[e._v("Stop")]),e._v(" "),r("el-dropdown-item",{attrs:{disabled:t.row.inCluster},nativeOn:{click:function(r){return e.handleRestart(t.row)}}},[e._v("Restart")]),e._v(" "),r("el-dropdown-item",{attrs:{disabled:t.row.runStatus},nativeOn:{click:function(r){return e.handleDelete(t.row)}}},[e._v("Delete")])],1)],1)]}}])})],1)],1)]),e._v(" "),e.replicateOfVisible?r("el-dialog",{attrs:{title:"Master Node List",visible:e.replicateOfVisible,"close-on-click-modal":!1,width:"80%"},on:{"update:visible":function(t){e.replicateOfVisible=t}}},[r("el-table",{attrs:{data:e.redisNodeList.filter(function(e){return e.inCluster}),stripe:"",size:"medium","default-sort":{prop:"slotRange",order:"ascending"}}},[r("el-table-column",{attrs:{label:"Link State",sortable:"",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(t.row.slot)+"\n          "),"connected"==t.row.linkState?r("el-tag",{attrs:{size:"mini",type:"success"}},[e._v(e._s(t.row.linkState))]):r("el-tag",{staticClass:"pointer",attrs:{size:"small",type:"warning"}},[e._v(e._s(t.row.linkState))])]}}],null,!1,1084991063)}),e._v(" "),r("el-table-column",{attrs:{label:"Flags",width:"90px"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.row.flags))])]}}],null,!1,221223753)}),e._v(" "),r("el-table-column",{attrs:{label:"Replica",width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.row.replicaNumber))])]}}],null,!1,1276046101)}),e._v(" "),r("el-table-column",{attrs:{label:"In Cluster",align:"center",sortable:""},scopedSlots:e._u([{key:"default",fn:function(e){return[e.row.inCluster?r("i",{staticClass:"el-icon-success status-icon normal-status"}):r("i",{staticClass:"el-icon-error status-icon normal-bad"})]}}],null,!1,1353933945)}),e._v(" "),r("el-table-column",{attrs:{label:"Run Status",align:"center",sortable:""},scopedSlots:e._u([{key:"default",fn:function(e){return[e.row.runStatus?r("i",{staticClass:"el-icon-success status-icon normal-status"}):r("i",{staticClass:"el-icon-error status-icon normal-bad"})]}}],null,!1,2493321961)}),e._v(" "),r("el-table-column",{attrs:{prop:"host",label:"Host",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{prop:"port",label:"Port",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{prop:"slotRange",label:"Slot Range",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{prop:"time",label:"Time",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"Operation",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"mini",type:"primary",disabled:(e.operationNode.nodeId==t.row.nodeId||e.operationNode.masterId==t.row.nodeId)&&e.operationNode.inCluster},on:{click:function(r){return e.replicateOf(t.row.nodeId)}}},[e._v("Replicate Of")])]}}],null,!1,2727245630)})],1)],1):e._e(),e._v(" "),e.failOverVisible?r("el-dialog",{attrs:{title:"Fail Over",visible:e.failOverVisible,width:"30%"},on:{"update:visible":function(t){e.failOverVisible=t}}},[r("span",[e._v(e._s(e.operationNode.host)+":"+e._s(e.operationNode.port)+" will become the master")]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.failOverVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(t){return e.failOver()}}},[e._v("Fail Over")])],1)]):e._e(),e._v(" "),e.importNodeVisible?r("el-dialog",{attrs:{title:"Import New Node",visible:e.importNodeVisible,"close-on-click-modal":!1,width:"30%"},on:{"update:visible":function(t){e.importNodeVisible=t}}},[r("el-form",{ref:"newRedisNode",attrs:{model:e.newRedisNode,size:"small"}},[r("el-form-item",{attrs:{label:"Redis Node",prop:"address",rules:e.rules.redisNode}},[r("el-input",{model:{value:e.newRedisNode.address,callback:function(t){e.$set(e.newRedisNode,"address",t)},expression:"newRedisNode.address"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.importNodeVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.importNode("newRedisNode")}}},[e._v("Confirm")])],1)],1):e._e(),e._v(" "),r("el-dialog",{attrs:{title:"Edit Config",visible:e.editConfigVisible,"close-on-click-modal":!1,width:"30%"},on:{"update:visible":function(t){e.editConfigVisible=t}}},[r("el-form",{ref:"redisConfig",attrs:{model:e.redisConfig,size:"small","label-position":"top"}},[r("el-form-item",{attrs:{label:"Config Key",prop:"configKey",rules:e.rules.configKey}},[r("el-select",{attrs:{filterable:"","allow-create":"","default-first-option":"",placeholder:"Please select config key"},on:{change:function(t){return e.getConfigCurrentValue(e.redisConfig)}},model:{value:e.redisConfig.configKey,callback:function(t){e.$set(e.redisConfig,"configKey",t)},expression:"redisConfig.configKey"}},e._l(e.configKeyList,function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"Config Value",prop:"configValue"}},[r("el-input",{model:{value:e.redisConfig.configValue,callback:function(t){e.$set(e.redisConfig,"configValue",t)},expression:"redisConfig.configValue"}})],1),e._v(" "),e._l(e.nodeConfigList,function(t){return r("p",{key:t.redisNode},[r("span",{staticStyle:{color:"#606266"}},[e._v(e._s(t.redisNode))]),e._v(" "),r("span",[r("b",[e._v(e._s(t.configValue))])])])})],2),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.editConfigVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.editConfig("redisConfig")}}},[e._v("Confirm")])],1)],1),e._v(" "),e.forgetVisible?r("el-dialog",{attrs:{title:"Forget Node",visible:e.forgetVisible,width:"30%"},on:{"update:visible":function(t){e.forgetVisible=t}}},[r("span",[e._v(e._s(e.operationNode.host)+":"+e._s(e.operationNode.port)+" will be forget")]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.forgetVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(t){return e.forget()}}},[e._v("Forget")])],1)]):e._e(),e._v(" "),e.moveSlotVisible?r("el-dialog",{attrs:{title:"Move Slot",visible:e.moveSlotVisible,"close-on-click-modal":!1,width:"30%"},on:{"update:visible":function(t){e.moveSlotVisible=t}}},[r("el-form",{ref:"slotRange",attrs:{model:e.slotRange,size:"small"}},[r("el-form-item",{attrs:{prop:"startSlot",label:"Start Slot",rules:e.rules.startSlot}},[r("el-input",{model:{value:e.slotRange.startSlot,callback:function(t){e.$set(e.slotRange,"startSlot",e._n(t))},expression:"slotRange.startSlot"}})],1),e._v(" "),r("el-form-item",{attrs:{prop:"endSlot",label:"End Slot",rules:e.rules.endSlot}},[r("el-input",{model:{value:e.slotRange.endSlot,callback:function(t){e.$set(e.slotRange,"endSlot",e._n(t))},expression:"slotRange.endSlot"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.moveSlotVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.moveSlot("slotRange")}}},[e._v("Confirm")])],1)],1):e._e(),e._v(" "),r("el-dialog",{attrs:{title:"Start Node",visible:e.startNodeVisible,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.startNodeVisible=t}}},[r("span",[e._v(e._s(e.operationNode.host)+":"+e._s(e.operationNode.port)+" will be start")]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.startNodeVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.startNode()}}},[e._v("Start")])],1)]),e._v(" "),r("el-dialog",{attrs:{title:"Stop Node",visible:e.stopNodeVisible,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.stopNodeVisible=t}}},[r("span",[e._v(e._s(e.operationNode.host)+":"+e._s(e.operationNode.port)+" will be stop")]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.stopNodeVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.stopNode()}}},[e._v("Stop")])],1)]),e._v(" "),r("el-dialog",{attrs:{title:"Restart Node",visible:e.restartNodeVisible,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.restartNodeVisible=t}}},[r("span",[e._v(e._s(e.operationNode.host)+":"+e._s(e.operationNode.port)+" will be restart")]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.restartNodeVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.restartNode()}}},[e._v("Restart")])],1)]),e._v(" "),r("el-dialog",{attrs:{title:"Delete Node",visible:e.deleteNodeVisible,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.deleteNodeVisible=t}}},[r("span",[e._v(e._s(e.operationNode.host)+":"+e._s(e.operationNode.port)+" will be delete")]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.deleteNodeVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.deleteNode()}}},[e._v("Delete")])],1)]),e._v(" "),r("el-dialog",{attrs:{title:"Init Slot",visible:e.initSlotsVisible,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.initSlotsVisible=t}}},[r("p",[e._v("\n      Cluster Slots All:\n      "),r("b",[e._v("16384")])]),e._v(" "),r("p",[e._v("\n      Cluster Slots Assigned:\n      "),r("b",[e._v(e._s(e.cluster.clusterSlotsAssigned))])]),e._v(" "),r("p",[e._v("\n      Cluster Slots Ok:\n      "),r("b",[e._v(e._s(e.cluster.clusterSlotsOk))])]),e._v(" "),r("p",[e._v("\n      Cluster Slots Pfail:\n      "),r("b",[e._v(e._s(e.cluster.clusterSlotsPfail))])]),e._v(" "),r("p",[e._v("\n      Cluster Slots Fail:\n      "),r("b",[e._v(e._s(e.cluster.clusterSlotsFail))])]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.initSlots()}}},[e._v("Init")])],1)]),e._v(" "),e.infoVisible?r("el-dialog",{attrs:{title:"Info - "+e.operationNode.host+":"+e.operationNode.port,visible:e.infoVisible,width:"50%","close-on-click-modal":!1,top:"5vh"},on:{"update:visible":function(t){e.infoVisible=t}}},[r("info",{attrs:{redisNode:e.operationNode}})],1):e._e(),e._v(" "),e.configVisible?r("el-dialog",{attrs:{title:"Config - "+e.operationNode.host+":"+e.operationNode.port,visible:e.configVisible,width:"50%","close-on-click-modal":!1,top:"5vh"},on:{"update:visible":function(t){e.configVisible=t}}},[r("config",{attrs:{redisNode:e.operationNode}})],1):e._e()],1)},staticRenderFns:[]},!1,function(e){r("p92f")},"data-v-6d68adf0",null).exports,Q=r("pFYg"),Z=r.n(Q),Y={data:function(){var e=this,t=function(e,t,r){if(t<=0)return r(new Error("Number must be greater than 0"));r()};return{dockerImages:[],machineImages:[],humpbackImages:[],installationParam:{groupId:"",clusterName:"",redisPassword:"",redisMode:"cluster",image:"",create:!0,machineIdList:[],machineList:[{ip:""},{ip:""}],autoBuild:!0,autoInit:!1,sudo:!0,machineUserName:"",machinePassword:"",redisNodes:"127.0.0.1:8001 master\n127.0.0.1:8002",installationEnvironment:0},installationInfoVisible:!1,installationConsole:"Prepare to install redis...",websocketURI:"",rules:{clusterName:[{required:!0,validator:function(e,t,r){if(o(t)||o(t.trim()))return r(new Error("Please enter cluster name"));var a="/cluster/validateClusterName/"+t;Le.get(a,null,function(e){var a=e.data;if(0!=a.code)return a.data,r(new Error(t+" has exist"));r()},function(e){return r(new Error("Network error, "+e))})},trigger:"blur"}],redisMode:[{required:!0,message:"Please select redis mode",trigger:"change"}],installationEnvironment:[{required:!0,message:"Please select installation environment",trigger:"change"}],image:[{required:!0,message:"Please select image",trigger:"change"}],machines:[{required:!0,message:"Please select machines",trigger:"change"}],startPort:[{required:!0,message:"Please enter start port",trigger:"blur"},{required:!0,validator:function(e,t,r){if(!/^([0-9]|[1-9]\d|[1-9]\d{2}|[1-9]\d{3}|[1-5]\d{4}|6[0-4]\d{3}|65[0-4]\d{2}|655[0-2]\d|6553[0-5])$/.test(t))return r(new Error("Incorrect port format"));r()},trigger:"blur"}],masterNumber:[{required:!0,message:"Please eneter master number",trigger:"blur"},{type:"number",message:"Please enter integer",trigger:"blur"},{required:!0,validator:t,trigger:"blur"},{required:!0,validator:function(t,r,a){if("standalone"==e.installationParam.redisMode&&r>1)return a(new Error("Standalone mode only need 1 master"));a()},trigger:"blur"}],replicaNumber:[{required:!0,message:"Please eneter replica number",trigger:"blur"},{type:"number",message:"Please enter integer",trigger:"blur"},{required:!0,validator:t,trigger:"blur"}],machineUserName:[{required:!0,message:"Please enter machine user name",trigger:"blur"}],machinePassword:[{required:!0,message:"Please enter machine password",trigger:"blur"}],redisNodes:[{required:!0,message:"Please enter redis topology",trigger:"blur"},{required:!0,validator:function(t,r,a){var s=r.trim();if(o(s))return a(new Error("Please enter topology"));var n=e.installationParam.machineUserName,i=e.installationParam.machinePassword;if(o(n)||o(i))return a(new Error("Please enter machine user name and password first"));for(var l=s.split(/[(\r\n)\r\n]+/),u=l.length,c=[],p=[],m=function(){var t=l[f].split(/\s+/),r=t.length;if(0==f){if(2!=r)return{v:a(new Error("Line "+(f+1)+": wrong format"))};if("master"!=t[1])return{v:a(new Error("Line "+(f+1)+": node not master"))}}if(0!=f&&"standalone"==e.installationParam.redisMode&&"master"==t[1])return{v:a(new Error("Line "+(f+1)+": standalone mode only need one master"))};var s=t[1];o(s)&&(s="slave");var u=t[0].split(":");if(d(u))return{v:a(new Error("Line "+(f+1)+": wrong format"))};var m=u[0],v=u[1],h={userName:n,password:i,host:m},g=!1;c.forEach(function(e){e.host!=m||(g=!0)}),g||c.push(h);var b=!1;if(p.forEach(function(e){e.host==m&&e.port==v&&(b=!0)}),b)return{v:a(new Error("Line "+(f+1)+": redis node repeat"))};p.push({host:m,port:v,nodeRole:s.toLocaleUpperCase()})},f=0;f<u;f++){var v=m();if("object"===(void 0===v?"undefined":Z()(v)))return v.v}e.installationParam.machineList=c,e.installationParam.redisNodeList=p,a()},trigger:"blur"}]},allMachineList:[],websock:null,step:-1,installationLoading:!1,humpbackEnabled:!1}},methods:{handleMachine:function(e){e.forEach(function(e){})},buildMachineIdList:function(){var e=this;this.installationParam.machineIdList=[],this.installationParam.machines.forEach(function(t){e.installationParam.machineIdList.push(t[1])})},buildParam:function(){var e=this.installationParam;e.autoBuild&&this.buildMachineIdList();var t={groupId:this.currentGroup.groupId,userId:Ae.getters.getUserId,clusterName:e.clusterName,redisPassword:e.redisPassword,redisMode:e.redisMode,installationEnvironment:e.installationEnvironment,image:e.image,clusterInfo:e.clusterInfo};this.installationParam.cluster=t},installationCheck:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;t.buildParam();try{t.initWebSocket()}catch(e){v.error("Open websocket failed.")}t.install()})},install:function(){var e=this;this.installationLoading=!0,this.step=0,Le.post("/installation/installFlow",this.installationParam,function(t){0==t.data.code?e.$router.push({name:"dashboard",params:{groupId:e.currentGroup.groupId}}):v.error("Install failed"),e.installationLoading=!1},function(t){e.installationLoading=!1,v.error(t)})},getDockerImageList:function(){var e=this;Le.get("/installation/getDockerImages",null,function(t){var r=t.data;0==r.code?e.dockerImages=r.data:v.error(r.message)},function(e){v.error(e)})},getMachineImageList:function(){var e=this;Le.get("/installation/getMachineImages",null,function(t){var r=t.data;0==r.code?e.machineImages=r.data:v.error(r.message)},function(e){v.error(e)})},getHumpbackImageList:function(){var e=this;Le.get("/installation/getHumpbackImages",null,function(t){var r=t.data;0==r.code?e.humpbackImages=r.data:v.error(r.message)},function(e){v.error(e)})},getMachineList:function(e){var t=this;if(!o(e)){var r="/machine/getHierarchyMachineList/"+e;Le.get(r,null,function(e){var r=e.data;if(0==r.code){var a=r.data;a.forEach(function(e){var r=e.machineGroupName;e.label=r,e.value=r,e.children.forEach(function(e){e.label=e.host,e.value=e.machineId}),t.allMachineList=a})}else v.error(r.message)},function(e){v.error(e)})}},validateMachine:function(e,t){},initWebSocket:function(){this.websock=new WebSocket(this.websocketURI),this.websock.onmessage=this.websocketonmessage,this.websock.onopen=this.websocketonopen,this.websock.onerror=this.websocketonerror,this.websock.onclose=this.websocketclose},websocketonopen:function(){v.info("Open socket"),this.websocketsend(this.installationParam.clusterName)},websocketonerror:function(){v.error("Build websocket failed, but you can still install.")},websocketonmessage:function(e){var t=e.data;o(t)||(t.indexOf("Start preparing installation")>-1?this.step=0:t.indexOf("Start pulling redis.conf")>-1?this.step=1:t.indexOf("Start pulling image")>-1?this.step=2:t.indexOf("Start installing redis node")>-1?this.step=3:t.indexOf("Start initializing")>-1?this.step=4:t.indexOf("Start saving to database")>-1&&(this.step=5),this.installationConsole+=" \n ",this.installationConsole+=t)},websocketsend:function(e){this.websock.send(e)},websocketclose:function(e){v.error("Close websocket",e)},getHumpbackEnabled:function(){var e=this;Le.get("/system/humpbackEnabled",null,function(t){var r=t.data.data;r&&(e.humpbackEnabled=r,e.getHumpbackImageList())},function(e){v.error(e)})},getServerAddress:function(){var e=this;Le.get("/system/getServerAddress",null,function(t){var r=t.data.data;e.websocketURI="ws://"+r+"/websocket/install"},function(e){v.error(e)})}},computed:{currentGroup:function(){return Ae.getters.getCurrentGroup},installationEnvironmentList:function(){return Ae.getters.getInstallationEnvironmentList}},watch:{"installationParam.autoBuild":function(e,t){this.$refs.installationParam.fields.map(function(e){if("startPort"===e.prop||"masterNumber"===e.prop||"replicaNumber"===e.prop||"machineUserName"===e.prop||"machinePassword"===e.prop||"topology"===e.prop||"machines"===e.prop)return e.resetField(),!1})},"installationParam.installationEnvironment":function(e,t){this.$refs.installationParam.fields.map(function(e){if("image"===e.prop)return e.resetField(),!1})},currentGroup:function(e){var t=e.groupId;this.$router.push({name:"installation",params:{groupId:t}})}},mounted:function(){this.getDockerImageList(),this.getMachineImageList();var e=this.currentGroup.groupId;this.getMachineList(e),this.getHumpbackEnabled(),this.getServerAddress()}},J=r("VU/8")(Y,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"body-wrapper",attrs:{id:"installation"}},[r("div",{staticClass:"step-wrapper"},[r("el-steps",{attrs:{active:e.step,"finish-status":"success"}},[r("el-step",{attrs:{title:"Environment Check"}}),e._v(" "),r("el-step",{attrs:{title:"Pull Config",description:""}}),e._v(" "),r("el-step",{attrs:{title:"Pull Image",description:""}}),e._v(" "),r("el-step",{attrs:{title:"Install",description:""}}),e._v(" "),r("el-step",{attrs:{title:"Init",description:""}}),e._v(" "),r("el-step",{attrs:{title:"Finish",description:""}})],1)],1),e._v(" "),r("el-row",[r("el-col",{directives:[{name:"loading",rawName:"v-loading",value:e.installationLoading,expression:"installationLoading"}],attrs:{xl:12,lg:12,md:24,sm:24}},[r("div",{staticClass:"form-wrapper"},[r("div",{staticClass:"form"},[r("el-form",{ref:"installationParam",staticClass:"demo-ruleForm",attrs:{model:e.installationParam,rules:e.rules,"label-width":"150px",size:"small"}},[r("el-form-item",{attrs:{label:"Group Name",prop:"groupName"}},[r("el-tag",{attrs:{size:"small"}},[e._v(e._s(e.currentGroup.groupName))])],1),e._v(" "),r("el-form-item",{attrs:{label:"Cluster Name",prop:"clusterName"}},[r("el-input",{attrs:{maxlength:"50","show-word-limit":""},model:{value:e.installationParam.clusterName,callback:function(t){e.$set(e.installationParam,"clusterName",t)},expression:"installationParam.clusterName"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Redis Password",prop:"redisPassword"}},[r("el-input",{attrs:{maxlength:"50","show-word-limit":""},model:{value:e.installationParam.redisPassword,callback:function(t){e.$set(e.installationParam,"redisPassword","string"==typeof t?t.trim():t)},expression:"installationParam.redisPassword"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Redis Mode",prop:"redisMode"}},[r("el-radio-group",{model:{value:e.installationParam.redisMode,callback:function(t){e.$set(e.installationParam,"redisMode",t)},expression:"installationParam.redisMode"}},[r("el-radio",{attrs:{label:"cluster"}},[e._v("Cluster")]),e._v(" "),r("el-radio",{attrs:{label:"standalone"}},[e._v("Standalone")])],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"Environment",prop:"installationEnvironment"}},[r("el-radio-group",{model:{value:e.installationParam.installationEnvironment,callback:function(t){e.$set(e.installationParam,"installationEnvironment",t)},expression:"installationParam.installationEnvironment"}},e._l(e.installationEnvironmentList,function(t){return r("el-radio",{key:t.type,attrs:{label:t.type}},[e._v(e._s(t.name))])}),1)],1),e._v(" "),0==e.installationParam.installationEnvironment?r("el-form-item",{attrs:{label:"Image",prop:"image"}},[r("el-select",{attrs:{"allow-create":"",filterable:"",placeholder:"Please choose image"},model:{value:e.installationParam.image,callback:function(t){e.$set(e.installationParam,"image","string"==typeof t?t.trim():t)},expression:"installationParam.image"}},e._l(e.dockerImages,function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1):1==e.installationParam.installationEnvironment?r("el-form-item",{attrs:{label:"Image",prop:"image"}},[r("el-select",{attrs:{placeholder:"Please choose image"},model:{value:e.installationParam.image,callback:function(t){e.$set(e.installationParam,"image","string"==typeof t?t.trim():t)},expression:"installationParam.image"}},e._l(e.machineImages,function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1):e._e(),e._v(" "),3==e.installationParam.installationEnvironment?r("el-form-item",{attrs:{label:"Image",prop:"image"}},[r("el-select",{attrs:{"allow-create":"",filterable:"",placeholder:"Please choose image"},model:{value:e.installationParam.image,callback:function(t){e.$set(e.installationParam,"image","string"==typeof t?t.trim():t)},expression:"installationParam.image"}},e._l(e.humpbackImages,function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1):e._e(),e._v(" "),r("el-form-item",{attrs:{label:"Auto Build",prop:"autoBuild"}},[r("el-switch",{model:{value:e.installationParam.autoBuild,callback:function(t){e.$set(e.installationParam,"autoBuild",t)},expression:"installationParam.autoBuild"}})],1),e._v(" "),e.installationParam.autoBuild?r("el-form-item",{attrs:{label:"Machine List",prop:"machines"}},[r("div",{staticClass:"block"},[r("el-cascader",{attrs:{placeholder:"Search",options:e.allMachineList,props:{multiple:!0},filterable:"",leafOnly:!0},on:{change:e.handleMachine},model:{value:e.installationParam.machines,callback:function(t){e.$set(e.installationParam,"machines",t)},expression:"installationParam.machines"}})],1)]):e._e(),e._v(" "),e.installationParam.autoBuild?r("el-form-item",{attrs:{label:"Start Port",prop:"startPort"}},[r("el-input",{model:{value:e.installationParam.startPort,callback:function(t){e.$set(e.installationParam,"startPort",e._n(t))},expression:"installationParam.startPort"}})],1):e._e(),e._v(" "),e.installationParam.autoBuild?r("el-form-item",{attrs:{label:"Master Number",prop:"masterNumber"}},[r("el-input",{model:{value:e.installationParam.masterNumber,callback:function(t){e.$set(e.installationParam,"masterNumber",e._n(t))},expression:"installationParam.masterNumber"}})],1):e._e(),e._v(" "),e.installationParam.autoBuild?r("el-form-item",{attrs:{label:"Replica Number",prop:"replicaNumber"}},[r("el-input",{model:{value:e.installationParam.replicaNumber,callback:function(t){e.$set(e.installationParam,"replicaNumber",e._n(t))},expression:"installationParam.replicaNumber"}})],1):e._e(),e._v(" "),e.installationParam.autoBuild?e._e():r("el-form-item",{attrs:{label:"Machine User",prop:"machineUserName"}},[r("el-input",{attrs:{placeholder:"Machine user name"},model:{value:e.installationParam.machineUserName,callback:function(t){e.$set(e.installationParam,"machineUserName","string"==typeof t?t.trim():t)},expression:"installationParam.machineUserName"}})],1),e._v(" "),e.installationParam.autoBuild?e._e():r("el-form-item",{attrs:{label:"Machine Password",prop:"machinePassword"}},[r("el-input",{attrs:{placeholder:"Machine password"},model:{value:e.installationParam.machinePassword,callback:function(t){e.$set(e.installationParam,"machinePassword","string"==typeof t?t.trim():t)},expression:"installationParam.machinePassword"}})],1),e._v(" "),e.installationParam.autoBuild?e._e():r("el-form-item",{attrs:{label:"Topology",prop:"redisNodes"}},[r("el-input",{staticClass:"textarea",attrs:{type:"textarea",autosize:{minRows:2,maxRows:500},placeholder:"Please enter redis node list"},model:{value:e.installationParam.redisNodes,callback:function(t){e.$set(e.installationParam,"redisNodes",t)},expression:"installationParam.redisNodes"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Sudo",prop:"sudo"}},[r("el-switch",{model:{value:e.installationParam.sudo,callback:function(t){e.$set(e.installationParam,"sudo",t)},expression:"installationParam.sudo"}}),e._v(" "),r("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"Whether to use sudo during the installation operation",placement:"top-start"}},[r("i",{staticClass:"el-icon-info info"})])],1),e._v(" "),r("el-form-item",{attrs:{label:"Cluster Info",prop:"clusterInfo"}},[r("el-input",{attrs:{type:"input"},model:{value:e.installationParam.clusterInfo,callback:function(t){e.$set(e.installationParam,"clusterInfo",t)},expression:"installationParam.clusterInfo"}})],1),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"success"},on:{click:function(t){return e.installationCheck("installationParam")}}},[e._v("Install")])],1)],1)],1)])]),e._v(" "),r("el-col",{attrs:{xl:12,lg:12,md:24,sm:24}},[r("div",{staticClass:"console-wrapper"},[r("div",{staticClass:"console-title"},[e._v("Redis Installation Console")]),e._v(" "),r("pre",{staticClass:"console"},[e._v(e._s(e.installationConsole))])])])],1)],1)},staticRenderFns:[]},!1,function(e){r("idhF")},"data-v-356c6346",null).exports,X={data:function(){return{alertChannelList:[],alertChannel:{},editVisible:!1,isUpdate:!1,deleteVisible:!1,rules:{channelName:[{required:!0,message:"Channel name can't be empty",trigger:"blur"}],smtpHost:[{required:!0,message:"SMTP host can't be empty",trigger:"blur"}],emailFrom:[{required:!0,message:"Email from can't be empty",trigger:"blur"},{required:!0,validator:function(e,t,r){if(!u(t))return r(new Error("Incorrect email format"));r()},trigger:"blur"}],emailTo:[{required:!0,message:"Email to can't be empty",trigger:"blur"}],webhook:[{required:!0,message:"Web hook can't be empty",trigger:"blur"},{required:!0,validator:function(e,t,r){if(!function(e){return/^(https?|ftp):\/\/([a-zA-Z0-9.-]+(:[a-zA-Z0-9.&%$-]+)*@)*((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3}|([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+\.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(:[0-9]+)*(\/($|[a-zA-Z0-9.,?'\\+&%$#=~_-]+))*$/.test(e)}(t))return r(new Error("Incorrect url format"));r()},trigger:"blur"}],corpId:[{required:!0,message:"Corp id can't be empty",trigger:"blur"}],agentId:[{required:!0,message:"Agent id can't be empty",trigger:"blur"}],corpSecret:[{required:!0,message:"Corp Secret can't be empty",trigger:"blur"}]},saveAlertChannelLoading:!1}},methods:{handleView:function(e,t){},editChannel:function(e,t){this.getAlertChannel(t.channelId),this.isUpdate=!0,this.editVisible=!0},handleDelete:function(e,t){this.alertChannel.channelId=t.channelId,this.deleteVisible=!0},deleteChannel:function(){var e=this;this.alertChannel.groupId=this.currentGroup.groupId,Le.post("/alert/channel/deleteAlertChannel",this.alertChannel,function(t){0==t.data.code?(e.getChannelList(e.currentGroup.groupId),e.deleteVisible=!1,e.alertChannel={channelType:0}):v.error("Delete alert channel failed")},function(e){v.error(e)})},getChannelList:function(e){var t=this,r="/alert/channel/getAlertChannel/group/"+e;Le.get(r,null,function(e){var r=e.data;if(0==r.code){var a=r.data;a.forEach(function(e){e.time=C(e.updateTime)}),t.alertChannelList=a}else v.error("Get alert channel list failed")},function(e){v.error(e)})},getAlertChannel:function(e){var t=this,r="/alert/channel/getAlertChannel/"+e;Le.get(r,null,function(e){var r=e.data;0==r.code?t.alertChannel=r.data:v.error("Get alert channel faild")},function(e){v.error(e)})},saveChannel:function(e){var t=this;this.$refs[e].validate(function(r){if(r){var a;a=t.isUpdate?"/alert/channel/updateAlertChannel":"/alert/channel/addAlertChannel",t.alertChannel.groupId=t.currentGroup.groupId,t.saveAlertChannelLoading=!0,Le.post(a,t.alertChannel,function(r){0==r.data.code?(t.getChannelList(t.currentGroup.groupId),t.editVisible=!1,t.$refs[e].resetFields()):v.error("Save alert channel failed."),t.saveAlertChannelLoading=!1},function(e){t.saveAlertChannelLoading=!1,v.error(e)})}})}},computed:{currentGroup:function(){return Ae.getters.getCurrentGroup}},watch:{"alertChannel.channelType":function(e,t){this.$refs.alertChannel.fields.map(function(e){return"channelName"===e.prop||"channelType"===e.prop||"channelInfo"===e.prop||(e.resetField(),!0)})},currentGroup:function(e){this.getChannelList(e.groupId)}},mounted:function(){var e=this.currentGroup.groupId;this.getChannelList(e)}},ee=r("VU/8")(X,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"body-wrapper",attrs:{id:"channel-manage"}},[r("div",{staticClass:"header-wrapper"},[r("div",[e._v(e._s(e.currentGroup.groupName))]),e._v(" "),r("div",[r("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){e.editVisible=!0,e.isUpdate=!1,e.alertChannel={}}}},[e._v("Create")])],1)]),e._v(" "),r("div",[r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.alertChannelList}},[r("el-table-column",{attrs:{type:"index",width:"50"}}),e._v(" "),r("el-table-column",{attrs:{prop:"channelName",label:"Channel Name",width:"150px;"}}),e._v(" "),r("el-table-column",{attrs:{label:"Channel Type",width:"200px;"},scopedSlots:e._u([{key:"default",fn:function(t){return["0"==t.row.channelType?r("el-popover",{attrs:{trigger:"hover",placement:"top"}},[r("p",[r("span",{staticClass:"label-color"},[e._v("Email From:")]),e._v("\n              "+e._s(t.row.emailFrom)+"\n            ")]),e._v(" "),r("p",[r("span",{staticClass:"label-color"},[e._v("Email To:")]),e._v("\n              "+e._s(t.row.emailTo)+"\n            ")]),e._v(" "),r("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[r("el-tag",{attrs:{size:"small",type:"success"}},[e._v("Email")])],1)]):e._e(),e._v(" "),"1"==t.row.channelType?r("el-popover",{attrs:{trigger:"hover",placement:"top"}},[r("p",[r("span",{staticClass:"label-color"},[e._v("Web Hook:")]),e._v("\n              "+e._s(t.row.webhook)+"\n            ")]),e._v(" "),r("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[r("el-tag",{attrs:{size:"small",type:"success"}},[e._v("WebChat Webhook")])],1)]):e._e(),e._v(" "),"2"==t.row.channelType?r("el-popover",{attrs:{trigger:"hover",placement:"top"}},[r("p",[r("span",{staticClass:"label-color"},[e._v("Web Hook:")]),e._v("\n              "+e._s(t.row.webhook)+"\n            ")]),e._v(" "),r("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[r("el-tag",{attrs:{size:"small",type:"primary"}},[e._v("DingDing Webhook")])],1)]):e._e(),e._v(" "),"3"==t.row.channelType?r("el-popover",{attrs:{trigger:"hover",placement:"top"}},[r("p",[r("span",{staticClass:"label-color"},[e._v("Corp ID:")]),e._v("\n              "+e._s(t.row.corpId)+"\n            ")]),e._v(" "),r("p",[r("span",{staticClass:"label-color"},[e._v("Agent ID:")]),e._v("\n              "+e._s(t.row.agentId)+"\n            ")]),e._v(" "),r("p",[r("span",{staticClass:"label-color"},[e._v("Corp Secret:")]),e._v("\n              "+e._s(t.row.corpSecret)+"\n            ")]),e._v(" "),r("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[r("el-tag",{attrs:{size:"small",type:"success"}},[e._v("WebChat App")])],1)]):e._e()]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"channelInfo",label:"Info"}}),e._v(" "),r("el-table-column",{attrs:{prop:"time",label:"Time"}}),e._v(" "),r("el-table-column",{attrs:{label:"Operation",width:"200px;"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(r){return e.editChannel(t.$index,t.row)}}},[e._v("Edit")]),e._v(" "),r("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(r){return e.handleDelete(t.$index,t.row)}}},[e._v("Delete")])]}}])})],1)],1),e._v(" "),r("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.saveAlertChannelLoading,expression:"saveAlertChannelLoading"}],attrs:{title:"Edit Channel",visible:e.editVisible,width:"60%","close-on-click-modal":!1},on:{"update:visible":function(t){e.editVisible=t}}},[r("el-form",{ref:"alertChannel",attrs:{model:e.alertChannel,rules:e.rules,"label-width":"135px"}},[r("el-form-item",{attrs:{label:"Channel Name",prop:"channelName"}},[r("el-input",{attrs:{size:"small"},model:{value:e.alertChannel.channelName,callback:function(t){e.$set(e.alertChannel,"channelName",t)},expression:"alertChannel.channelName"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Channel Type",prop:"channelType"}},[r("el-radio-group",{attrs:{size:"medium"},model:{value:e.alertChannel.channelType,callback:function(t){e.$set(e.alertChannel,"channelType","string"==typeof t?t.trim():t)},expression:"alertChannel.channelType"}},[r("el-radio",{attrs:{label:0}},[e._v("Email")]),e._v(" "),r("el-radio",{attrs:{label:1}},[e._v("Wechat Web Hook")]),e._v(" "),r("el-radio",{attrs:{label:2}},[e._v("DingDing Web Hook")]),e._v(" "),r("el-radio",{attrs:{label:3}},[e._v("Wechat App")])],1)],1),e._v(" "),0==e.alertChannel.channelType?r("div",[r("el-form-item",{attrs:{label:"SMTP Host",prop:"smtpHost"}},[r("el-input",{attrs:{size:"small"},model:{value:e.alertChannel.smtpHost,callback:function(t){e.$set(e.alertChannel,"smtpHost","string"==typeof t?t.trim():t)},expression:"alertChannel.smtpHost"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Email User Name",prop:"emailUserName"}},[r("el-input",{attrs:{size:"small"},model:{value:e.alertChannel.emailUserName,callback:function(t){e.$set(e.alertChannel,"emailUserName","string"==typeof t?t.trim():t)},expression:"alertChannel.emailUserName"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Email Password",prop:"emailPassword"}},[r("el-input",{attrs:{size:"small"},model:{value:e.alertChannel.emailPassword,callback:function(t){e.$set(e.alertChannel,"emailPassword","string"==typeof t?t.trim():t)},expression:"alertChannel.emailPassword"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Email From",prop:"emailFrom"}},[r("el-input",{attrs:{size:"small"},model:{value:e.alertChannel.emailFrom,callback:function(t){e.$set(e.alertChannel,"emailFrom","string"==typeof t?t.trim():t)},expression:"alertChannel.emailFrom"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Email To",prop:"emailTo"}},[r("el-input",{attrs:{size:"small"},model:{value:e.alertChannel.emailTo,callback:function(t){e.$set(e.alertChannel,"emailTo","string"==typeof t?t.trim():t)},expression:"alertChannel.emailTo"}})],1)],1):e._e(),e._v(" "),1==e.alertChannel.channelType||2==e.alertChannel.channelType?r("el-form-item",{attrs:{label:"Web Hook",prop:"webhook"}},[r("el-input",{attrs:{size:"small"},model:{value:e.alertChannel.webhook,callback:function(t){e.$set(e.alertChannel,"webhook","string"==typeof t?t.trim():t)},expression:"alertChannel.webhook"}})],1):e._e(),e._v(" "),3==e.alertChannel.channelType?r("div",[r("el-form-item",{attrs:{label:"Corp Id",prop:"corpId"}},[r("el-input",{attrs:{size:"small"},model:{value:e.alertChannel.corpId,callback:function(t){e.$set(e.alertChannel,"corpId","string"==typeof t?t.trim():t)},expression:"alertChannel.corpId"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Agent Id",prop:"agentId"}},[r("el-input",{attrs:{size:"small"},model:{value:e.alertChannel.agentId,callback:function(t){e.$set(e.alertChannel,"agentId","string"==typeof t?t.trim():t)},expression:"alertChannel.agentId"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Corp Secret",prop:"corpSecret"}},[r("el-input",{attrs:{size:"small"},model:{value:e.alertChannel.corpSecret,callback:function(t){e.$set(e.alertChannel,"corpSecret","string"==typeof t?t.trim():t)},expression:"alertChannel.corpSecret"}})],1)],1):e._e(),e._v(" "),r("el-form-item",{attrs:{label:"Channel Info",prop:"channelInfo"}},[r("el-input",{attrs:{size:"small"},model:{value:e.alertChannel.channelInfo,callback:function(t){e.$set(e.alertChannel,"channelInfo",t)},expression:"alertChannel.channelInfo"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e.isUpdate?r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.saveChannel("alertChannel")}}},[e._v("Update")]):r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.saveChannel("alertChannel")}}},[e._v("Confirm")])],1)],1),e._v(" "),r("el-dialog",{attrs:{title:"Delete Alert Channel",visible:e.deleteVisible,width:"30%"},on:{"update:visible":function(t){e.deleteVisible=t}}},[r("span",[e._v("\n      Are you sure to delete\n      "),r("b",[e._v(e._s(e.alertChannel.channelName))]),e._v(" ?\n    ")]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.deleteVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.deleteChannel()}}},[e._v("Delete")])],1)])],1)},staticRenderFns:[]},!1,function(e){r("36zs")},"data-v-038d9fc0",null).exports,te={data:function(){return{alertRuleList:[],alertRule:{valid:!0,global:!1,clusterAlert:!1},editVisible:!1,isUpdate:!1,deleteVisible:!1,ruleKeyList:[{value:"used_memory",label:"used_memory(MB)"},{value:"used_memory_rss",label:"used_memory_rss(MB)"},{value:"used_memory_overhead",label:"used_memory_overhead(MB)"},{value:"used_memory_dataset",label:"used_memory_dataset(MB)"},{value:"fragmentation_ratio",label:"fragmentation_ratio(MB)"},{value:"connections_received",label:"connections_received"},{value:"rejected_connections",label:"rejected_connections"},{value:"connected_clients",label:"connected_clients"},{value:"blocked_clients",label:"blocked_clients"},{value:"commands_processed",label:"commands_processed"},{value:"instantaneous_ops_per_sec",label:"instantaneous_ops_per_sec"},{value:"sync_full",label:"sync_full"},{value:"sync_partial_ok",label:"sync_partial_ok"},{value:"sync_partial_err",label:"sync_partial_err"},{value:"keyspace_hits_ratio",label:"keyspace_hits_ratio"},{value:"keys",label:"keys"},{value:"expires",label:"expires"},{value:"cpu_sys",label:"cpu_sys"},{value:"cpu_user",label:"cpu_user"}],compareTypeList:[{value:1,label:">"},{value:-1,label:"<"},{value:0,label:"="},{value:2,label:"!="}],checkCycleList:[{value:5,label:"5 Min"},{value:10,label:"10 Min"},{value:15,label:"15 Min"},{value:30,label:"30 Min"},{value:60,label:"1 Hour"},{value:180,label:"3 Hour"},{value:360,label:"6 Hour"},{value:720,label:"12 Hour"},{value:1440,label:"1 day"}],rules:{ruleKey:[{required:!0,message:"Rule key can't be empty",trigger:"blur"}],compareType:[{required:!0,message:"Compare type can't be empty",trigger:"blur"}],ruleValue:[{required:!0,message:"Rule value can't be empty",trigger:"blur"}],checkCycle:[{required:!0,message:"Check cycle can't be empty",trigger:"blur"}]},saveAlertRuleLoading:!1}},methods:{handleView:function(e,t){},editAlertRule:function(e,t){this.getAlertRule(t.ruleId),this.isUpdate=!0,this.editVisible=!0},handleDelete:function(e,t){this.alertRule=t,this.deleteVisible=!0},createAlertRule:function(){this.editVisible=!0,this.isUpdate=!1,this.alertRule={valid:!0,global:!1,clusterAlert:!1}},getAlertRuleList:function(e){var t=this,r="/alert/rule/getAlertRule/group/"+e;Le.get(r,null,function(e){var r=e.data;if(0==r.code){var a=r.data;a.forEach(function(e){e.time=C(e.updateTime);var t=e.compareType;e.compareSign=0==t?"=":1==t?">":-1==t?"<":"!="}),t.alertRuleList=a}else v.error("Get alert rule list failed")},function(e){v.error(e)})},getAlertRule:function(e){var t=this,r="/alert/rule/getAlertRule/"+e;Le.get(r,null,function(e){var r=e.data;0==r.code?t.alertRule=r.data:v.error("Get alert rule faild")},function(e){v.error(e)})},saveAlertRule:function(e){var t=this;this.$refs[e].validate(function(r){if(r){var a;a=t.isUpdate?"/alert/rule/updateAlertRule":"/alert/rule/addAlertRule",t.alertRule.groupId=t.currentGroup.groupId,t.saveAlertRuleLoading=!0,t.alertRule.clusterAlert&&(t.alertRule.ruleKey="-",t.alertRule.compareType=0,t.alertRule.ruleValue=0),Le.post(a,t.alertRule,function(r){0==r.data.code?(t.getAlertRuleList(t.currentGroup.groupId),t.editVisible=!1,t.$refs[e].resetFields()):v.error("Save alert rule failed"),t.saveAlertRuleLoading=!1},function(e){t.saveAlertRuleLoading=!1,v.error(e)})}})},deleteAlertRule:function(){var e=this;Le.post("/alert/rule/deleteAlertRule",this.alertRule,function(t){0==t.data.code?(e.getAlertRuleList(e.currentGroup.groupId),e.deleteVisible=!1):v.error("Delete alert rule failed")},function(e){v.error(e)})}},computed:{currentGroup:function(){return Ae.getters.getCurrentGroup}},watch:{currentGroup:function(e){this.getAlertRuleList(e.groupId)}},mounted:function(){var e=this.currentGroup.groupId;this.getAlertRuleList(e)}},re=r("VU/8")(te,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"body-wrapper",attrs:{id:"rule-manage"}},[r("div",{staticClass:"header-wrapper"},[r("div",[e._v(e._s(e.currentGroup.groupName))]),e._v(" "),r("div",[r("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){return e.createAlertRule()}}},[e._v("Create")])],1)]),e._v(" "),r("div",[r("el-table",{attrs:{data:e.alertRuleList}},[r("el-table-column",{attrs:{type:"index",width:"50"}}),e._v(" "),r("el-table-column",{attrs:{label:"Alert Rule"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.clusterAlert?r("span",[r("el-tag",{attrs:{size:"small",type:"primary"}},[e._v("Cluster Alert")])],1):r("span",[e._v(e._s(t.row.ruleKey)+" "+e._s(t.row.compareSign)+" "+e._s(t.row.ruleValue))])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"Rule Status"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.valid?r("el-tag",{attrs:{size:"small",type:"success"}},[e._v("valid")]):r("el-tag",{attrs:{size:"small",type:"danger"}},[e._v("Invalid")])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"Is Global"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.global?r("el-tag",{attrs:{size:"small"}},[e._v("Global")]):e._e()]}}])}),e._v(" "),r("el-table-column",{attrs:{property:"checkCycle",label:"Check Cycle(Min)"}}),e._v(" "),r("el-table-column",{attrs:{property:"ruleInfo",label:"Info"}}),e._v(" "),r("el-table-column",{attrs:{property:"time",label:"Time"}}),e._v(" "),r("el-table-column",{attrs:{label:"Operation",width:"250px;"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(r){return e.editAlertRule(t.$index,t.row)}}},[e._v("Edit")]),e._v(" "),r("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(r){return e.handleDelete(t.$index,t.row)}}},[e._v("Delete")])]}}])})],1)],1),e._v(" "),r("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.saveAlertRuleLoading,expression:"saveAlertRuleLoading"}],attrs:{title:"Edit Rule",visible:e.editVisible,width:"50%","close-on-click-modal":!1},on:{"update:visible":function(t){e.editVisible=t}}},[r("el-form",{ref:"alertRule",attrs:{model:e.alertRule,rules:e.rules,"label-width":"135px"}},[r("el-form-item",{attrs:{label:"Cluster Alert",prop:"clusterAlert"}},[r("el-switch",{model:{value:e.alertRule.clusterAlert,callback:function(t){e.$set(e.alertRule,"clusterAlert",t)},expression:"alertRule.clusterAlert"}})],1),e._v(" "),e.alertRule.clusterAlert?e._e():r("div",[r("el-form-item",{attrs:{label:"Rule Key",prop:"ruleKey"}},[r("el-select",{attrs:{size:"small",placeholder:"Select rule key"},model:{value:e.alertRule.ruleKey,callback:function(t){e.$set(e.alertRule,"ruleKey",t)},expression:"alertRule.ruleKey"}},e._l(e.ruleKeyList,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"Compare Type",prop:"compareType"}},[r("el-select",{attrs:{size:"small",placeholder:"Select compare type"},model:{value:e.alertRule.compareType,callback:function(t){e.$set(e.alertRule,"compareType",t)},expression:"alertRule.compareType"}},e._l(e.compareTypeList,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"Rule Value",prop:"ruleValue"}},[r("el-input",{staticStyle:{width:"215px"},attrs:{size:"small",placeholder:"Please enter rule value"},model:{value:e.alertRule.ruleValue,callback:function(t){e.$set(e.alertRule,"ruleValue",t)},expression:"alertRule.ruleValue"}})],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"Check Cycle",prop:"checkCycle"}},[r("el-select",{attrs:{size:"small",placeholder:"Select check circle"},model:{value:e.alertRule.checkCycle,callback:function(t){e.$set(e.alertRule,"checkCycle",t)},expression:"alertRule.checkCycle"}},e._l(e.checkCycleList,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"Is Valid",prop:"isValid"}},[r("el-switch",{model:{value:e.alertRule.valid,callback:function(t){e.$set(e.alertRule,"valid",t)},expression:"alertRule.valid"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Is Global",prop:"isGlobal"}},[r("el-switch",{model:{value:e.alertRule.global,callback:function(t){e.$set(e.alertRule,"global",t)},expression:"alertRule.global"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Rule Info",prop:"ruleInfo"}},[r("el-input",{attrs:{size:"small",placeholder:"Please enter rule info"},model:{value:e.alertRule.ruleInfo,callback:function(t){e.$set(e.alertRule,"ruleInfo",t)},expression:"alertRule.ruleInfo"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.editVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.saveAlertRule("alertRule")}}},[e._v("Confirm")])],1)],1),e._v(" "),r("el-dialog",{attrs:{title:"Delete Alert Rule",visible:e.deleteVisible,width:"30%"},on:{"update:visible":function(t){e.deleteVisible=t}}},[r("span",[e._v("\n      Are you sure to delete\n      "),e.alertRule.clusterAlert?e._e():r("b",[e._v(e._s(e.alertRule.ruleKey)+" "+e._s(e.alertRule.compareSign)+" "+e._s(e.alertRule.ruleValue))]),e._v(" ?\n    ")]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.deleteVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.deleteAlertRule()}}},[e._v("Delete")])],1)])],1)},staticRenderFns:[]},!1,function(e){r("OQxI")},"data-v-bfb59af0",null).exports,ae={data:function(){return{cluster:{},alertRecordList:[],alertRuleList:[],alertRuleListNotUsed:[],alertChannelList:[],activeName:"record",addAlertRuleVisible:!1,addAlertChannelVisible:!1,deleteAlertRuleVisible:!1,deleteAlertChannelVisible:!1,deleteAlertRecordVisible:!1,deletingAlertRule:{},deletingAlertChannel:{},deletingAlertRecordIds:[],alertRecordCurrentPageNo:1,alertRecordPageSize:20,alertRecordTotalPage:0,alertRecordPaginationShow:!1,alertRecordTotalCount:0}},methods:{handleClick:function(e,t){},addRuleSelectionChange:function(e){var t="";e.length>0&&e.forEach(function(e){t+=e.ruleId,t+=","}),this.cluster.ruleIds=t},addChannelSelectionChange:function(e){var t="";e.length>0&&e.forEach(function(e){t+=e.channelId,t+=","}),this.cluster.channelIds=t},getAlertRecordList:function(e){var t=this,r="/alert/record/getAlertRecord/cluster/"+e+"?pageNo="+this.alertRecordCurrentPageNo;Le.get(r,null,function(e){var r=e.data;if(0==r.code){var a=r.data.alertRecords;if(null==a||0==a.length)return void(t.alertRecordList=a);a.forEach(function(e){e.time=C(e.updateTime)}),t.alertRecordList=a,t.alertRecordTotalCount=r.data.totalCount,t.alertRecordTotalPage=r.data.totalPage,t.alertRecordTotalPage>1&&(t.alertRecordPaginationShow=!0)}else v.error("Get alert record list failed")},function(e){v.error(e)})},handleCurrentChange:function(e){this.alertRecordCurrentPageNo=e;var t=this.cluster.clusterId;this.getAlertRecordList(t)},getIndex:function(e){return this.indexBasic+e+1},getAlertRuleList:function(e){var t=this,r="/alert/rule/getAlertRule/cluster/"+e;Le.get(r,null,function(e){var r=e.data;if(0==r.code){var a=r.data;t.alertRuleList=t.buildAlertRuleList(a)}else v.error("Get alert rule list failed")},function(e){v.error(e)})},getAlertRuleListNotUsed:function(e){var t=this,r="/alert/rule/getAlertRuleNotUsed/"+e;Le.get(r,null,function(e){var r=e.data;0==r.code?(t.alertRuleListNotUsed=t.buildAlertRuleList(r.data),t.addAlertRuleVisible=!0):v.error("Get alert rule list not used failed")},function(e){v.error(e)})},buildAlertRuleList:function(e){return null==e||0==e.length?[]:(e.forEach(function(e){e.time=C(e.updateTime),e.lastCheck=C(e.lastCheckTime);var t=e.compareType;e.compareSign=0==t?"=":1==t?">":-1==t?"<":"!="}),e)},addAlertRule:function(){var e=this;o(this.cluster.ruleIds)?v.warning("No rule"):Le.post("/cluster/addAlertRule",this.cluster,function(t){var r=t.data,a=e.cluster.clusterId;e.getAlertRuleList(a),0==r.code?e.addAlertRuleVisible=!1:v.error("Save alert rule failed")},function(e){v.error(e)})},handleDeleteAlertRule:function(e){this.cluster.ruleIds=e.ruleId,this.deletingAlertRule=e,this.deleteAlertRuleVisible=!0},deleteAlertRule:function(){var e=this;Le.post("/cluster/deleteAlertRule",this.cluster,function(t){var r=t.data,a=e.cluster.clusterId;e.getAlertRuleList(a),0==r.code?e.deleteAlertRuleVisible=!1:v.error("Delete alert rule failed")},function(e){v.error(e)})},getAlertChannelList:function(e){var t=this,r="/alert/channel/getAlertChannel/cluster/"+e;Le.get(r,null,function(e){var r=e.data;0==r.code?t.alertChannelList=t.buildAlertChannelList(r.data):v.error("Get alert channel list failed")},function(e){v.error(e)})},getAlertChannelListNotUsed:function(e){var t=this,r="/alert/channel/getAlertChannelNotUsed/"+e;Le.get(r,null,function(e){var r=e.data;0==r.code?(t.alertRuleListNotUsed=t.buildAlertChannelList(r.data),t.addAlertChannelVisible=!0):v.error("Get alert channel list not used failed")},function(e){v.error(e)})},buildAlertChannelList:function(e){return null==e||0==e.length?[]:(e.forEach(function(e){e.time=C(e.updateTime)}),e)},addAlertChannel:function(){var e=this;o(this.cluster.channelIds)||Le.post("/cluster/addAlertChannel",this.cluster,function(t){var r=t.data,a=e.cluster.clusterId;e.getAlertChannelList(a),0==r.code?e.addAlertChannelVisible=!1:v.error("Save alert channel failed")},function(e){v.error(e)})},handleDeleteAlertChannel:function(e){this.cluster.channelIds=e.channelId,this.deletingAlertChannel=e,this.deleteAlertChannelVisible=!0},deleteAlertChannel:function(){var e=this;Le.post("/cluster/deleteAlertChannel",this.cluster,function(t){var r=t.data,a=e.cluster.clusterId;e.getAlertChannelList(a),0==r.code?e.deleteAlertChannelVisible=!1:v.error("Delete alert channel failed")},function(e){v.error(e)})},handleDeleteAlertRecord:function(e){this.deletingAlertRecordIds=[],this.deletingAlertRecordIds.push(e.recordId),this.deleteAlertRecordVisible=!0},handleRecordSelectionChange:function(e){var t=this;0!=e.length&&(this.deletingAlertRecordIds=[],e.forEach(function(e){t.deletingAlertRecordIds.push(e.recordId)}))},handleDeleteAlertRecordBatch:function(){0!=this.deletingAlertRecordIds.length&&(this.deleteAlertRecordVisible=!0)},deleteAlertRecord:function(){var e=this,t={groupId:this.currentGroup.groupId,recordsIds:this.deletingAlertRecordIds};Le.post("/alert/record/deleteAlertRecordBatch",t,function(t){var r=t.data,a=e.cluster.clusterId;e.getAlertRecordList(a),0==r.code?e.deleteAlertRecordVisible=!1:v.error("Delete alert record failed")},function(e){v.error(e)})}},computed:{currentGroup:function(){return Ae.getters.getCurrentGroup},indexBasic:function(){return(this.currentPageNo-1)*this.pageSize}},watch:{currentGroup:function(e){this.$router.push({name:"dashboard",params:{groupId:e.groupId}})}},mounted:function(){var e=this,t=this.$route.params.clusterId;y(t,function(r){e.cluster=r,e.getAlertRecordList(t),e.getAlertRuleList(t),e.getAlertChannelList(t)})}},se=r("VU/8")(ae,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"alert-manage"}},[r("div",{staticClass:"overview-wrapper"},[r("el-row",{attrs:{gutter:24}},[r("el-col",{attrs:{xl:8,lg:8,md:12,sm:12}},[r("div",{staticClass:"card-panel"},[r("div",{staticClass:"card-panel-icon-wrapper card-panel-icon-alert"},[r("i",{staticClass:"el-icon-bell"})]),e._v(" "),r("div",{staticClass:"card-panel-info-wrapper"},[r("div",{staticClass:"card-panel-info-key"},[e._v("Alert Record")]),e._v(" "),r("div",{staticClass:"card-panel-info-value"},[e._v(e._s(e.alertRecordTotalCount))])])])]),e._v(" "),r("el-col",{attrs:{xl:8,lg:8,md:12,sm:12}},[r("div",{staticClass:"card-panel"},[r("div",{staticClass:"card-panel-icon-wrapper card-panel-icon-rule"},[r("i",{staticClass:"el-icon-notebook-2"})]),e._v(" "),r("div",{staticClass:"card-panel-info-wrapper"},[r("div",{staticClass:"card-panel-info-key"},[e._v("Alert Rule")]),e._v(" "),r("div",{staticClass:"card-panel-info-value"},[e._v(e._s(e.alertRuleList.length))])])])]),e._v(" "),r("el-col",{attrs:{xl:8,lg:8,md:12,sm:12}},[r("div",{staticClass:"card-panel"},[r("div",{staticClass:"card-panel-icon-wrapper card-panel-icon-channel"},[r("i",{staticClass:"el-icon-coin"})]),e._v(" "),r("div",{staticClass:"card-panel-info-wrapper"},[r("div",{staticClass:"card-panel-info-key"},[e._v("Alert Channel")]),e._v(" "),r("div",{staticClass:"card-panel-info-value"},[e._v(e._s(e.alertChannelList.length))])])])])],1)],1),e._v(" "),r("div",{staticClass:"body-wrapper"},[r("div",{staticClass:"title-wrapper"},[r("span",[e._v(e._s(e.cluster.clusterName))]),e._v(" "),"HEALTH"==e.cluster.clusterState?r("i",{staticClass:"el-icon-sunny health",attrs:{title:"Status"}}):e._e()]),e._v(" "),r("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[r("el-tab-pane",{attrs:{label:"Alert Record",name:"record"}},[r("div",{staticClass:"operation-wrapper"},[r("div",{staticClass:"batch-title"},[e._v("Batch Operation")]),e._v(" "),r("div",{staticStyle:{display:"flex","justify-content":"space-between"}},[r("div",[r("el-link",{attrs:{type:"danger",underline:!1,icon:"el-icon-delete"},on:{click:e.handleDeleteAlertRecordBatch}},[e._v("Delete")])],1)])]),e._v(" "),r("el-table",{attrs:{data:e.alertRecordList,"default-sort":{prop:"time",order:"descending"}},on:{"selection-change":e.handleRecordSelectionChange}},[r("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),r("el-table-column",{attrs:{type:"index",width:"60",index:e.getIndex}}),e._v(" "),r("el-table-column",{attrs:{property:"redisNode",label:"Redis Node"}}),e._v(" "),r("el-table-column",{attrs:{property:"alertRule",label:"Alert Rule"}}),e._v(" "),r("el-table-column",{attrs:{property:"actualData",label:"Reason"}}),e._v(" "),r("el-table-column",{attrs:{label:"Is Global"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.global?r("el-tag",{attrs:{size:"small"}},[e._v("Global")]):e._e()]}}])}),e._v(" "),r("el-table-column",{attrs:{property:"checkCycle",label:"Check Cycle"}}),e._v(" "),r("el-table-column",{attrs:{property:"ruleInfo",label:"Info"}}),e._v(" "),r("el-table-column",{attrs:{property:"time",label:"Time"}}),e._v(" "),r("el-table-column",{attrs:{label:"Operation",width:"100px;"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(r){return e.handleDeleteAlertRecord(t.row)}}},[e._v("Delete")])]}}])})],1),e._v(" "),e.alertRecordPaginationShow?r("el-pagination",{staticStyle:{"text-align":"center"},attrs:{"current-page":e.alertRecordCurrentPageNo,"page-size":e.alertRecordPageSize,layout:"prev, pager, next, jumper",total:e.alertRecordTotalCount},on:{"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.alertRecordCurrentPageNo=t},"update:current-page":function(t){e.alertRecordCurrentPageNo=t}}}):e._e()],1),e._v(" "),r("el-tab-pane",{attrs:{label:"Alert Rule",name:"rule"}},[r("div",{staticClass:"operation-wrapper"},[r("div",{staticStyle:{display:"flex","justify-content":"flex-end"}},[r("el-link",{attrs:{underline:!1,icon:"el-icon-plus",type:"primary"},on:{click:function(t){return e.getAlertRuleListNotUsed(e.cluster.clusterId)}}},[e._v("Add Rule")])],1)]),e._v(" "),r("el-table",{attrs:{data:e.alertRuleList,"default-sort":{prop:"time",order:"descending"}}},[r("el-table-column",{attrs:{type:"index",width:"50"}}),e._v(" "),r("el-table-column",{attrs:{label:"Alert Rule"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.clusterAlert?r("span",[r("el-tag",{attrs:{size:"small",type:"primary"}},[e._v("Cluster Alert")])],1):r("span",[e._v(e._s(t.row.ruleKey)+" "+e._s(t.row.compareSign)+" "+e._s(t.row.ruleValue))])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"Rule Status"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.valid?r("el-tag",{attrs:{size:"mini",type:"success"}},[e._v("valid")]):r("el-tag",{attrs:{size:"mini",type:"danger"}},[e._v("Invalid")])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"Is Global"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.global?r("el-tag",{attrs:{size:"small"}},[e._v("Global")]):e._e()]}}])}),e._v(" "),r("el-table-column",{attrs:{property:"ruleInfo",label:"Info"}}),e._v(" "),r("el-table-column",{attrs:{property:"lastCheck",label:"Last Check"}}),e._v(" "),r("el-table-column",{attrs:{property:"time",label:"Time"}}),e._v(" "),r("el-table-column",{attrs:{label:"Operation",width:"100px;"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.global?void 0:[r("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(r){return e.handleDeleteAlertRule(t.row)}}},[e._v("Delete")])]}}],null,!0)})],1)],1),e._v(" "),r("el-tab-pane",{attrs:{label:"Alert Channel",name:"channel"}},[r("div",{staticClass:"operation-wrapper"},[r("div",{staticStyle:{display:"flex","justify-content":"flex-end"}},[r("el-link",{attrs:{underline:!1,icon:"el-icon-plus",type:"primary"},on:{click:function(t){return e.getAlertChannelListNotUsed(e.cluster.clusterId)}}},[e._v("Add Channel")])],1)]),e._v(" "),r("el-table",{attrs:{data:e.alertChannelList,"default-sort":{prop:"time",order:"descending"}}},[r("el-table-column",{attrs:{type:"index",width:"50"}}),e._v(" "),r("el-table-column",{attrs:{property:"channelName",label:"Channel Name"}}),e._v(" "),r("el-table-column",{attrs:{label:"Channel Type"},scopedSlots:e._u([{key:"default",fn:function(t){return["0"==t.row.channelType?r("el-popover",{attrs:{trigger:"hover",placement:"top"}},[r("p",[r("span",{staticClass:"label-color"},[e._v("Email From:")]),e._v("\n                  "+e._s(t.row.emailFrom)+"\n                ")]),e._v(" "),r("p",[r("span",{staticClass:"label-color"},[e._v("Email To:")]),e._v("\n                  "+e._s(t.row.emailTo)+"\n                ")]),e._v(" "),r("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[r("el-tag",{attrs:{size:"small",type:"success"}},[e._v("Email")])],1)]):e._e(),e._v(" "),"1"==t.row.channelType?r("el-popover",{attrs:{trigger:"hover",placement:"top"}},[r("p",[r("span",{staticClass:"label-color"},[e._v("Web Hook:")]),e._v("\n                  "+e._s(t.row.webhook)+"\n                ")]),e._v(" "),r("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[r("el-tag",{attrs:{size:"small",type:"success"}},[e._v("WebChat Webhook")])],1)]):e._e(),e._v(" "),"2"==t.row.channelType?r("el-popover",{attrs:{trigger:"hover",placement:"top"}},[r("p",[r("span",{staticClass:"label-color"},[e._v("Web Hook:")]),e._v("\n                  "+e._s(t.row.webhook)+"\n                ")]),e._v(" "),r("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[r("el-tag",{attrs:{size:"small",type:"primary"}},[e._v("DingDing Webhook")])],1)]):e._e(),e._v(" "),"3"==t.row.channelType?r("el-popover",{attrs:{trigger:"hover",placement:"top"}},[r("p",[r("span",{staticClass:"label-color"},[e._v("Corp ID:")]),e._v("\n                  "+e._s(t.row.corpId)+"\n                ")]),e._v(" "),r("p",[r("span",{staticClass:"label-color"},[e._v("Agent ID:")]),e._v("\n                  "+e._s(t.row.agentId)+"\n                ")]),e._v(" "),r("p",[r("span",{staticClass:"label-color"},[e._v("Corp Secret:")]),e._v("\n                  "+e._s(t.row.corpSecret)+"\n                ")]),e._v(" "),r("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[r("el-tag",{attrs:{size:"small",type:"success"}},[e._v("WebChat App")])],1)]):e._e()]}}])}),e._v(" "),r("el-table-column",{attrs:{property:"channelInfo",label:"Info"}}),e._v(" "),r("el-table-column",{attrs:{property:"time",label:"Time"}}),e._v(" "),r("el-table-column",{attrs:{label:"Operation",width:"100px;"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(r){return e.handleDeleteAlertChannel(t.row)}}},[e._v("Delete")])]}}])})],1)],1)],1)],1),e._v(" "),r("el-dialog",{attrs:{title:"Add Alert Rule",visible:e.addAlertRuleVisible},on:{"update:visible":function(t){e.addAlertRuleVisible=t}}},[r("el-table",{attrs:{data:e.alertRuleListNotUsed,stripe:""},on:{"selection-change":e.addRuleSelectionChange}},[r("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),r("el-table-column",{attrs:{label:"Alert Rule"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.clusterAlert?r("span",[r("el-tag",{attrs:{size:"small",type:"primary"}},[e._v("Cluster Alert")])],1):r("span",[e._v(e._s(t.row.ruleKey)+" "+e._s(t.row.compareSign)+" "+e._s(t.row.ruleValue))])]}}])}),e._v(" "),r("el-table-column",{attrs:{property:"checkCycle",label:"Check Cycle(Min)"}}),e._v(" "),r("el-table-column",{attrs:{property:"ruleInfo",label:"Info"}}),e._v(" "),r("el-table-column",{attrs:{property:"time",label:"Time"}})],1),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.addAlertRule()}}},[e._v("Confirm")])],1)],1),e._v(" "),r("el-dialog",{attrs:{title:"Delete Alert Rule",visible:e.deleteAlertRuleVisible},on:{"update:visible":function(t){e.deleteAlertRuleVisible=t}}},[e._v("\n    Are you sure to delete\n    "),r("b",[e._v(e._s(e.deletingAlertRule.ruleKey)+" "+e._s(e.deletingAlertRule.compareSign)+" "+e._s(e.deletingAlertRule.ruleValue))]),e._v(" ?\n    "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.deleteAlertRuleVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.deleteAlertRule()}}},[e._v("Confirm")])],1)]),e._v(" "),r("el-dialog",{attrs:{title:"Add Alert Channel",visible:e.addAlertChannelVisible},on:{"update:visible":function(t){e.addAlertChannelVisible=t}}},[r("el-table",{attrs:{data:e.alertRuleListNotUsed,stripe:""},on:{"selection-change":e.addChannelSelectionChange}},[r("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),r("el-table-column",{attrs:{property:"channelName",label:"Channel Name",width:"150px;"}}),e._v(" "),r("el-table-column",{attrs:{label:"Channel Type",width:"200px;"},scopedSlots:e._u([{key:"default",fn:function(t){return["0"==t.row.channelType?r("el-popover",{attrs:{trigger:"hover",placement:"top"}},[r("p",[r("span",{staticClass:"label-color"},[e._v("Email From:")]),e._v("\n              "+e._s(t.row.emailFrom)+"\n            ")]),e._v(" "),r("p",[r("span",{staticClass:"label-color"},[e._v("Email To:")]),e._v("\n              "+e._s(t.row.emailTo)+"\n            ")]),e._v(" "),r("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[r("el-tag",{attrs:{size:"small",type:"success"}},[e._v("Email")])],1)]):e._e(),e._v(" "),"1"==t.row.channelType?r("el-popover",{attrs:{trigger:"hover",placement:"top"}},[r("p",[r("span",{staticClass:"label-color"},[e._v("Web Hook:")]),e._v("\n              "+e._s(t.row.webhook)+"\n            ")]),e._v(" "),r("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[r("el-tag",{attrs:{size:"small",type:"success"}},[e._v("WebChat Webhook")])],1)]):e._e(),e._v(" "),"2"==t.row.channelType?r("el-popover",{attrs:{trigger:"hover",placement:"top"}},[r("p",[r("span",{staticClass:"label-color"},[e._v("Web Hook:")]),e._v("\n              "+e._s(t.row.webhook)+"\n            ")]),e._v(" "),r("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[r("el-tag",{attrs:{size:"small",type:"primary"}},[e._v("DingDing Webhook")])],1)]):e._e(),e._v(" "),"3"==t.row.channelType?r("el-popover",{attrs:{trigger:"hover",placement:"top"}},[r("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[r("el-tag",{attrs:{size:"small",type:"success"}},[e._v("WebChat App")])],1)]):e._e()]}}])}),e._v(" "),r("el-table-column",{attrs:{property:"channelInfo",label:"Info"}}),e._v(" "),r("el-table-column",{attrs:{property:"time",label:"Time"}})],1),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.addAlertChannel()}}},[e._v("Confirm")])],1)],1),e._v(" "),r("el-dialog",{attrs:{title:"Delete Alert Channel",visible:e.deleteAlertChannelVisible,width:"30%"},on:{"update:visible":function(t){e.deleteAlertChannelVisible=t}}},[r("span",[e._v("\n      Are you sure to delete\n      "),r("b",[e._v(e._s(e.deletingAlertChannel.channelName))]),e._v(" ?\n    ")]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.deleteAlertChannelVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.deleteAlertChannel()}}},[e._v("Delete")])],1)]),e._v(" "),r("el-dialog",{attrs:{title:"Delete Alert Record",visible:e.deleteAlertRecordVisible,width:"30%"},on:{"update:visible":function(t){e.deleteAlertRecordVisible=t}}},[r("span",[e._v("Are you sure to delete?")]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.deleteAlertChannelVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.deleteAlertRecord()}}},[e._v("Delete")])],1)])],1)},staticRenderFns:[]},!1,function(e){r("AVYe")},"data-v-a9d20084",null).exports,ne={data:function(){var e=this;return{machineList:[],machineGroupNameList:[],editMachineVisible:!1,isUpdate:!1,deleteVisible:!1,deleteBatchVisible:!1,batchDelete:!1,machines:{hostList:[{value:""}],sshPort:22},rules:{machineGroupName:[{required:!0,validator:function(e,t,r){if(o(t)||o(t.trim()))return r(new Error("Please select or enter machine group name"));r()},trigger:"blur"}],userName:[{required:!0,validator:function(e,t,r){if(o(t)||o(t.trim()))return r(new Error("Please enter machine user name"));r()},trigger:"blur"}],password:[{required:!0,validator:function(e,t,r){if(o(t)||o(t.trim()))return r(new Error("Please enter machine password"));r()},trigger:"blur"}],host:[{required:!0,validator:function(e,t,r){return o(t)||o(t.trim())?r(new Error("Please enter machine ip")):function(e){return/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/.test(e)}(t)?void r():r(new Error("Incorrect ip format"))},trigger:"blur"},{required:!0,validator:function(t,r,a){var s=e.machines.userName,n=e.machines.password,i=e.machines.sshPort;if(o(s)||o(s.trim())||o(n)||o(n.trim()))return a(new Error("Please enter user name and passwor first"));var l={userName:s,password:n,host:r,sshPort:i};Le.post("/machine/validateConnection",l,function(e){var t=e.data;if(0!=t.code)return a(new Error(t.message));a()},function(e){return a(new Error("Network error"))})},trigger:"blur"}]},search:"",selectedMachineList:[],saveMachineLoading:!1}},methods:{getMachineList:function(e){var t=this;if(!o(e)){var r="/machine/getMachineList/"+e;Le.get(r,null,function(e){var r=e.data;if(0==r.code){var a=r.data;a.forEach(function(e){e.time=C(e.updateTime)}),t.machineList=a}else v.error("Get machine list failed")},function(e){v.error(e)})}},getMachineGroupNameList:function(e){var t=this,r="/machine/getMachineGroupNameList/"+e;Le.get(r,null,function(e){var r=e.data;0==r.code?t.machineGroupNameList=r.data:v.error("Get machine group name list failed")},function(e){v.error(e)})},buildMachineList:function(e){var t=this,r=[];if(this.isUpdate)return r.push(e),r;var a=this.machines.machineGroupName,s=this.machines.userName,n=this.machines.password,i=this.machines.token,l=this.machines.hostList,u=this.machines.machineInfo,c=this.machines.sshPort;return c=o(c)?22:c,l.forEach(function(e){r.push({groupId:t.currentGroupId,machineGroupName:a,userName:s,password:n,token:i,host:e.value,sshPort:c,machineInfo:u})}),r},saveMachines:function(e){var t=this;this.$refs[e].validate(function(r){if(r){var a,s=t.buildMachineList(t.machines);a=t.isUpdate?"/machine/updateMachine":"/machine/addMachineList",t.saveMachineLoading=!0,Le.post(a,s,function(r){0==r.data.code?(t.editMachineVisible=!1,t.getMachineGroupNameList(t.currentGroupId),t.getMachineList(t.currentGroupId)):v.error("Save machines failed"),t.$refs[e].resetFields(),t.saveMachineLoading=!1},function(e){t.saveMachineLoading=!0,v.error(e)})}})},editMachine:function(e,t){this.machines=t,this.editMachineVisible=!0,this.isUpdate=!0},handleDelete:function(e,t){this.machines=t,this.deleteVisible=!0,this.batchDelete=!1},handleDeleteBatch:function(){this.batchDelete=!0,0==this.selectedMachineList.length?v.warning("Please select machine"):this.deleteBatchVisible=!0},deleteMachine:function(){var e=this,t="",r=void 0;this.batchDelete?(t="/machine/deleteMachineBatch",(r=this.selectedMachineList).forEach(function(e){e.updateTime=new Date})):(t="/machine/deleteMachine",(r=this.machines).updateTime=new Date),Le.post(t,r,function(t){0==t.data.code?(e.deleteVisible=!1,e.deleteBatchVisible=!1,e.getMachineGroupNameList(e.currentGroupId),e.getMachineList(e.currentGroupId),e.machines={hostList:[{value:""}]},e.selectedMachineList=[]):v.error("Delete machine failed")},function(e){v.error(e)})},removeHost:function(e){if(1!=this.machines.hostList.length){var t=this.machines.hostList.indexOf(e);-1!==t&&this.machines.hostList.splice(t,1)}},addHost:function(){this.machines.hostList.length>=20||this.machines.hostList.push({value:"",key:Date.now()})},handleSelectionChange:function(e){this.selectedMachineList=e}},computed:{currentGroupId:function(){return Ae.getters.getCurrentGroup.groupId}},watch:{currentGroupId:function(e){this.getMachineList(e),this.$router.push({name:"machine-manage",params:{groupId:e}})}},mounted:function(){var e=this.currentGroupId;this.getMachineList(e),this.getMachineGroupNameList(e)}},ie=r("VU/8")(ne,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"body-wrapper"},[r("div",{staticClass:"operation-wrapper"},[r("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){e.editMachineVisible=!0,e.isUpdate=!1,e.machines={hostList:[{value:""}]}}}},[e._v("Import Machine")])],1),e._v(" "),r("div",{staticClass:"batch-operation-wrapper"},[r("div",{staticClass:"batch-title"},[e._v("Batch Operation")]),e._v(" "),r("el-row",[r("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDeleteBatch()}}},[e._v("Delete")])],1)],1),e._v(" "),r("div",[r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.machineList,center:"","default-sort":{prop:"machineGroupName",order:"ascending"}},on:{"selection-change":e.handleSelectionChange}},[r("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),r("el-table-column",{attrs:{property:"machineGroupName",label:"Machine Group Name",width:"200",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{property:"host",label:"Host",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{property:"userName",label:"User Name"}}),e._v(" "),r("el-table-column",{attrs:{label:"Password",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-popover",{attrs:{trigger:"hover",placement:"top"}},[r("p",[e._v(e._s(t.row.password))]),e._v(" "),r("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[r("el-tag",{attrs:{size:"small",type:"info"}},[e._v("******")])],1)])]}}])}),e._v(" "),r("el-table-column",{attrs:{property:"machineInfo",label:"Info"}}),e._v(" "),r("el-table-column",{attrs:{property:"time",label:"Time",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"Operation",width:"200px;"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(r){return e.editMachine(t.$index,t.row)}}},[e._v("Edit")]),e._v(" "),r("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(r){return e.handleDelete(t.$index,t.row)}}},[e._v("Delete")])]}}])})],1)],1),e._v(" "),r("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.saveMachineLoading,expression:"saveMachineLoading"}],attrs:{title:"Edit machines",visible:e.editMachineVisible,width:"50%","close-on-click-modal":!1},on:{"update:visible":function(t){e.editMachineVisible=t}}},[r("el-form",{ref:"machines",attrs:{model:e.machines,rules:e.rules,size:"small","label-width":"135px"}},[r("el-form-item",{attrs:{label:"Machine Group",prop:"machineGroupName"}},[r("el-select",{attrs:{filterable:"","allow-create":"","default-first-option":"",placeholder:"Select or enter group"},model:{value:e.machines.machineGroupName,callback:function(t){e.$set(e.machines,"machineGroupName",t)},expression:"machines.machineGroupName"}},e._l(e.machineGroupNameList,function(e,t){return r("el-option",{key:t,attrs:{label:e,value:e}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"User Name",prop:"userName"}},[r("el-input",{model:{value:e.machines.userName,callback:function(t){e.$set(e.machines,"userName",t)},expression:"machines.userName"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Password",prop:"password"}},[r("el-input",{model:{value:e.machines.password,callback:function(t){e.$set(e.machines,"password",t)},expression:"machines.password"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"SSH Port",prop:"sshPort"}},[r("el-input",{model:{value:e.machines.sshPort,callback:function(t){e.$set(e.machines,"sshPort",e._n(t))},expression:"machines.sshPort"}})],1),e._v(" "),e.isUpdate?r("el-form-item",{attrs:{label:"Host",prop:"host",rules:e.rules.host}},[r("el-input",{model:{value:e.machines.host,callback:function(t){e.$set(e.machines,"host",t)},expression:"machines.host"}})],1):r("div",e._l(e.machines.hostList,function(t,a){return r("el-form-item",{key:t.key,attrs:{label:"Host "+(a+1),prop:"hostList."+a+".value",rules:e.rules.host}},[r("el-input",{model:{value:t.value,callback:function(r){e.$set(t,"value",r)},expression:"host.value"}},[r("el-button",{attrs:{slot:"append",icon:"el-icon-delete"},on:{click:function(r){return r.preventDefault(),e.removeHost(t)}},slot:"append"})],1)],1)}),1),e._v(" "),r("el-form-item",{attrs:{label:"Machine Info",prop:"machineInfo"}},[r("el-input",{attrs:{maxlength:"50","show-word-limit":""},model:{value:e.machines.machineInfo,callback:function(t){e.$set(e.machines,"machineInfo",t)},expression:"machines.machineInfo"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e.isUpdate?e._e():r("el-button",{attrs:{size:"small"},on:{click:function(t){return e.addHost()}}},[e._v("New Host")]),e._v(" "),e.isUpdate?r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.saveMachines("machines")}}},[e._v("Update")]):r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.saveMachines("machines")}}},[e._v("Confirm")])],1)],1),e._v(" "),r("el-dialog",{attrs:{title:"Delete Machine",visible:e.deleteVisible,width:"30%"},on:{"update:visible":function(t){e.deleteVisible=t}}},[r("span",[e._v("\n      Are you sure to delete\n      "),r("b",[e._v(e._s(e.machines.machineGroupName)+" "+e._s(e.machines.host))]),e._v(" ?\n    ")]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.deleteVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.deleteMachine(e.machines)}}},[e._v("Delete")])],1)]),e._v(" "),r("el-dialog",{attrs:{title:"Delete Machine Batch",visible:e.deleteBatchVisible,width:"30%"},on:{"update:visible":function(t){e.deleteBatchVisible=t}}},[r("span",[e._v("\n      Are you sure to delete ?\n      "),r("br"),e._v(" "),e._l(e.selectedMachineList,function(t,a){return r("div",{key:a},[e._v(e._s(t.machineGroupName)+" "+e._s(t.host))])})],2),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.deleteBatchVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.deleteMachine(e.selectedMachineList)}}},[e._v("Delete")])],1)])],1)},staticRenderFns:[]},!1,function(e){r("LnKd")},"data-v-b7441a64",null).exports,le={data:function(){var e=this;return{createGroupVisible:!1,group:{groupName:""},rules:{groupName:[{required:!0,validator:function(t,r,a){if(o(r)||o(r.trim()))return a(new Error("Please enter group name"));var s="/group/validateGroupName/"+r;Le.get(s,null,function(t){var s=t.data.code,n=t.data.data,i=e.group.groupId;if(0!=s&&i!=n.groupId)return a(new Error(r+" has exist"));a()},function(e){return a(new Error("Network error, "+e))})},trigger:"blur"}]},saveGroupLoading:!1}},methods:{saveGroup:function(e){var t=this;this.$refs[e].validate(function(e){if(e){t.saveGroupLoading=!0;var r=Ae.getters.getUser;t.group.userId=r.userId;var a;a=o(t.group.groupId)?"/group/addGroup":"/group/updateGroup",Le.post(a,t.group,function(e){0==e.data.code?(t.createGroupVisible=!1,t.group={},function(e){Le.post("/group/getGroupList",e,function(e){if(0===e.data.code){var t=e.data.data;t.forEach(function(e){e.time=C(e.updateTime)}),Ae.dispatch("setGroupList",t)}else v.error("Get group list failed")},function(e){v.error(e)})}(r)):v.error("Save group failed"),t.saveGroupLoading=!1},function(e){t.saveGroupLoading=!1,v.error(e)})}})},closeHandler:function(){this.group={}},editGroup:function(e,t){this.group=t,this.createGroupVisible=!0},deleteGroup:function(e,t){}},computed:{groupList:function(){return Ae.getters.getGroupList}},mounted:function(){}},oe=r("VU/8")(le,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"body-wrapper",attrs:{id:"user-manage"}},[r("div",{staticClass:"operation-wrapper"},[r("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){e.createGroupVisible=!0,e.group={}}}},[e._v("Create")])],1),e._v(" "),r("el-table",{attrs:{data:e.groupList}},[r("el-table-column",{attrs:{type:"index",width:"50"}}),e._v(" "),r("el-table-column",{attrs:{property:"groupName",label:"Group Name"}}),e._v(" "),r("el-table-column",{attrs:{property:"groupInfo",label:"Info"}}),e._v(" "),r("el-table-column",{attrs:{property:"time",label:"Time"}}),e._v(" "),r("el-table-column",{attrs:{label:"Operation",width:"150px;"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(r){return e.editGroup(t.$index,t.row)}}},[e._v("Edit")])]}}])})],1),e._v(" "),r("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.saveGroupLoading,expression:"saveGroupLoading"}],attrs:{title:"Create Group",visible:e.createGroupVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.createGroupVisible=t},close:function(t){return e.closeHandler()}}},[r("el-form",{ref:"group",attrs:{model:e.group,"label-width":"120px",size:"small"}},[r("el-form-item",{attrs:{label:"Group Name",prop:"groupName",rules:e.rules.groupName}},[r("el-input",{attrs:{maxlength:"50","show-word-limit":""},model:{value:e.group.groupName,callback:function(t){e.$set(e.group,"groupName",t)},expression:"group.groupName"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Group Info",prop:"groupInfo"}},[r("el-input",{model:{value:e.group.groupInfo,callback:function(t){e.$set(e.group,"groupInfo",t)},expression:"group.groupInfo"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.saveGroup("group")}}},[e._v("Confirm")])],1)],1)],1)},staticRenderFns:[]},!1,function(e){r("4RNS")},"data-v-3859f51f",null).exports,ue={data:function(){var e,t=this;return e={userList:[],grantedUserList:[],user:{},isUpdate:!1,editUserVisible:!1,editGrantUserVisible:!1,deleteUserVisible:!1,revokeUserVisible:!1},G()(e,"isUpdate",!1),G()(e,"rules",{userRole:[{required:!0,message:"Please select user role",trigger:"blur"}],userName:[{required:!0,message:"Please enter user name",trigger:"blur"},{required:!0,validator:function(e,r,a){var s="/user/validateUserName/"+r;Le.get(s,null,function(e){var s=e.data;0==s.code?a():t.user.userId!==s.data.userId?a(new Error(r+" has been used")):a()},function(e){return a(new Error("Network error"))})},trigger:"blur"}],password:[{required:!0,message:"Please enter password",trigger:"blur"}],email:[{validator:function(e,t,r){if(!o(t)&&!u(t))return r(new Error("Incorrect format"));r()},trigger:"blur"}],mobile:[{validator:function(e,t,r){if(!o(t)&&!c(t))return r(new Error("Incorrect format"));r()},trigger:"blur"}]}),G()(e,"grantUserRules",{userRole:[{required:!0,message:"Please select user role",trigger:"blur"}],userName:[{required:!0,message:"Please enter user name",trigger:"blur"},{required:!0,validator:function(e,r,a){var s="/user/validateUserName/"+r;Le.get(s,null,function(e){var s=e.data;if(0==s.code)a(new Error(r+" not exist"));else{var n=s.data;Le.get("/user/isGranted/"+t.currentGroup.groupId+"/"+n.userId,null,function(e){if(0!=e.data.code)return a(new Error(r+" has been granted"));a()},function(e){return a(new Error("Network error"))})}},function(e){return a(new Error("Network error"))})},trigger:"blur"}]}),G()(e,"saveUserLoading",!1),G()(e,"grantUserLoading",!1),e},methods:{handleEdit:function(e){this.getUserById(e.userId),this.isUpdate=!0,this.editUserVisible=!0},handleDelete:function(e){this.user=e,this.deleteUserVisible=!0},handleRevoke:function(e){this.user=e,this.revokeUserVisible=!0},getUserList:function(e){var t=this,r="/user/getUserList/"+e;Le.get(r,null,function(e){var r=e.data;if(0==r.code){var a=r.data;a.forEach(function(e){var t=e.avatar;o(t)||(e.avatar=""+t),e.time=C(e.updateTime)}),t.userList=a}},function(e){v.error(e)})},getGrantedUserList:function(e){var t=this,r="/user/getGrantedUserList/"+e;Le.get(r,null,function(e){var r=e.data;if(0==r.code){var a=r.data;a.forEach(function(e){var t=e.avatar;o(t)||(e.avatar=""+t),e.time=C(e.updateTime)}),t.grantedUserList=a}},function(e){v.error(e)})},getUserById:function(e){var t=this,r="/user/getUser/"+e;Le.get(r,null,function(e){var r=e.data;0==r.code?t.user=r.data:v.error("Get user failed")},function(e){v.error(e)})},saveUser:function(e){var t=this;this.$refs[e].validate(function(r){if(r){t.saveUserLoading=!0;var a=t.currentGroup.groupId;t.user.groupId=a;var s;s=t.isUpdate?"/user/updateUser":"/user/addUser",Le.post(s,t.user,function(r){var s=r.data;t.getUserList(a),0==s.code?(t.editUserVisible=!1,t.$refs[e].resetFields()):v.error("save user failed"),t.saveUserLoading=!1},function(e){t.saveUserLoading=!1,v.error(e)})}})},saveGroupUser:function(e){var t=this;this.$refs[e].validate(function(r){if(r){t.grantUserLoading=!0;var a=t.currentGroup.groupId;t.user.groupId=a,Le.post("/user/grantUser",t.user,function(r){var s=r.data;t.getGrantedUserList(a),0==s.code?(t.editGrantUserVisible=!1,t.$refs[e].resetFields()):v.error("Save user failed"),t.grantUserLoading=!1},function(e){t.grantUserLoading=!1,v.error(e)})}})},deleteUser:function(){var e=this;Le.post("/user/deleteUser",this.user,function(t){e.getUserList(e.currentGroup.groupId),e.deleteUserVisible=!1,e.user={}},function(e){v.error(e)})},revokeUser:function(){var e=this;Le.post("/user/revokeUser",this.user,function(t){e.getGrantedUserList(e.currentGroup.groupId),e.revokeUserVisible=!1,e.user={}},function(e){v.error(e)})}},computed:{currentGroup:function(){return Ae.getters.getCurrentGroup},currentUser:function(){return Ae.getters.getUser}},watch:{currentGroup:function(e){var t=e.groupId;this.getUserList(t),this.getGrantedUserList(t),this.$router.push({name:"user-manage",params:{groupId:t}})}},mounted:function(){var e=this.currentGroup.groupId;this.getUserList(e),this.getGrantedUserList(e)}},ce=r("VU/8")(ue,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"container-wrapper",attrs:{id:"user-manage"}},[r("div",[r("div",{staticClass:"operation-wrapper"},[r("div",[e._v("Current Group")]),e._v(" "),r("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){e.user={},e.editUserVisible=!0,e.isUpdate=!1}}},[e._v("Create")])],1),e._v(" "),r("el-table",{attrs:{data:e.userList}},[r("el-table-column",{attrs:{type:"index",width:"50"}}),e._v(" "),r("el-table-column",{attrs:{prop:"userName",label:"User Name"}}),e._v(" "),r("el-table-column",{attrs:{label:"User Role"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.userRole?r("el-tag",{attrs:{size:"small",type:"success"}},[e._v("Super Admin")]):1==t.row.userRole?r("el-tag",{attrs:{size:"small",type:"primary"}},[e._v("Admin")]):r("el-tag",{attrs:{size:"small",type:"info"}},[e._v("Member")])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"Avatar"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-image",{attrs:{src:t.row.avatar,fit:"cover"}},[r("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[e._v(e._s(t.row.userName))])])]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"email",label:"Email"}}),e._v(" "),r("el-table-column",{attrs:{prop:"mobile",label:"Mobile"}}),e._v(" "),r("el-table-column",{attrs:{prop:"time",label:"Time"}}),e._v(" "),r("el-table-column",{attrs:{label:"Operation",width:"200px;"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.currentUser.userRole<=t.row.userRole?r("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(r){return e.handleEdit(t.row)}}},[e._v("Edit")]):e._e(),e._v(" "),e.currentUser.userRole<=t.row.userRole&&e.currentUser.userId!=t.row.userId?r("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(r){return e.handleDelete(t.row)}}},[e._v("Delete")]):e._e()]}}])})],1)],1),e._v(" "),r("div",{staticClass:"grant-wrapper"},[r("div",{staticClass:"operation-wrapper"},[r("div",[e._v("Other Groups")]),e._v(" "),r("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){e.user={},e.editGrantUserVisible=!0}}},[e._v("Grant")])],1),e._v(" "),r("el-table",{attrs:{data:e.grantedUserList}},[r("el-table-column",{attrs:{type:"index",width:"50"}}),e._v(" "),r("el-table-column",{attrs:{prop:"userName",label:"User Name"}}),e._v(" "),r("el-table-column",{attrs:{label:"User Role"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.userRole?r("el-tag",{attrs:{size:"small",type:"success"}},[e._v("Super Admin")]):1==t.row.userRole?r("el-tag",{attrs:{size:"small",type:"primary"}},[e._v("Admin")]):r("el-tag",{attrs:{size:"small",type:"info"}},[e._v("Member")])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"Avatar"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-image",{attrs:{src:t.row.avatar,fit:"cover"}},[r("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[e._v(e._s(t.row.userName))])])]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"email",label:"Email"}}),e._v(" "),r("el-table-column",{attrs:{prop:"mobile",label:"Mobile"}}),e._v(" "),r("el-table-column",{attrs:{prop:"time",label:"Time"}}),e._v(" "),r("el-table-column",{attrs:{label:"Operation",width:"200px;"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(r){return e.handleRevoke(t.row)}}},[e._v("Revoke")])]}}])})],1)],1),e._v(" "),r("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.saveUserLoading,expression:"saveUserLoading"}],attrs:{title:"Create User",visible:e.editUserVisible},on:{"update:visible":function(t){e.editUserVisible=t}}},[r("el-form",{ref:"user",attrs:{model:e.user,rules:e.rules,"label-width":"100px",size:"small"}},[r("el-form-item",{attrs:{label:"Group Name"}},[r("el-tag",{attrs:{size:"small"}},[e._v(e._s(e.currentGroup.groupName))])],1),e._v(" "),r("el-form-item",{attrs:{prop:"userRole",label:"User Role"}},[r("el-select",{attrs:{placeholder:"Please select user role"},model:{value:e.user.userRole,callback:function(t){e.$set(e.user,"userRole",t)},expression:"user.userRole"}},[r("el-option",{attrs:{label:"Member",value:2}}),e._v(" "),e.currentUser.userRole<2?r("el-option",{attrs:{label:"Admin",value:1}}):e._e(),e._v(" "),e.currentUser.userRole<1?r("el-option",{attrs:{label:"Super Admin",value:0}}):e._e()],1)],1),e._v(" "),r("el-form-item",{attrs:{prop:"userName",label:"User Name"}},[r("el-input",{model:{value:e.user.userName,callback:function(t){e.$set(e.user,"userName","string"==typeof t?t.trim():t)},expression:"user.userName"}})],1),e._v(" "),r("el-form-item",{attrs:{prop:"password",label:"Password"}},[r("el-input",{model:{value:e.user.password,callback:function(t){e.$set(e.user,"password","string"==typeof t?t.trim():t)},expression:"user.password"}})],1),e._v(" "),r("el-form-item",{attrs:{prop:"email",label:"Email"}},[r("el-input",{model:{value:e.user.email,callback:function(t){e.$set(e.user,"email","string"==typeof t?t.trim():t)},expression:"user.email"}})],1),e._v(" "),r("el-form-item",{attrs:{prop:"mobile",label:"Mobile"}},[r("el-input",{model:{value:e.user.mobile,callback:function(t){e.$set(e.user,"mobile","string"==typeof t?t.trim():t)},expression:"user.mobile"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.saveUser("user")}}},[e._v("Confirm")])],1)],1),e._v(" "),r("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.grantUserLoading,expression:"grantUserLoading"}],attrs:{title:"Grant User",visible:e.editGrantUserVisible},on:{"update:visible":function(t){e.editGrantUserVisible=t}}},[r("el-form",{ref:"user",attrs:{model:e.user,rules:e.grantUserRules,"label-width":"100px",size:"small"}},[r("el-form-item",{attrs:{label:"Group Name"}},[r("el-tag",{attrs:{size:"small"}},[e._v(e._s(e.currentGroup.groupName))])],1),e._v(" "),r("el-form-item",{attrs:{prop:"userRole",label:"User Role"}},[r("el-select",{attrs:{placeholder:"Please select user role"},model:{value:e.user.userRole,callback:function(t){e.$set(e.user,"userRole",t)},expression:"user.userRole"}},[r("el-option",{attrs:{label:"Member",value:2}}),e._v(" "),e.currentUser.userRole<2?r("el-option",{attrs:{label:"Admin",value:1}}):e._e(),e._v(" "),e.currentUser.userRole<1?r("el-option",{attrs:{label:"Super Admin",value:0}}):e._e()],1)],1),e._v(" "),r("el-form-item",{attrs:{prop:"userName",label:"User Name"}},[r("el-input",{model:{value:e.user.userName,callback:function(t){e.$set(e.user,"userName","string"==typeof t?t.trim():t)},expression:"user.userName"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.saveGroupUser("user")}}},[e._v("Confirm")])],1)],1),e._v(" "),r("el-dialog",{attrs:{title:"Delete User",visible:e.deleteUserVisible,width:"30%"},on:{"update:visible":function(t){e.deleteUserVisible=t}}},[r("span",[e._v("\n      Are you sure to delete\n      "),r("b",[e._v(e._s(e.user.userName))]),e._v(" ?\n    ")]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.deleteUserVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.deleteUser()}}},[e._v("Delete")])],1)]),e._v(" "),r("el-dialog",{attrs:{title:"Revoke User",visible:e.revokeUserVisible,width:"30%"},on:{"update:visible":function(t){e.revokeUserVisible=t}}},[r("span",[e._v("\n      Are you sure to revoke\n      "),r("b",[e._v(e._s(e.user.userName))]),e._v(" ?\n    ")]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.revokeUserVisible=!1}}},[e._v("Cancel")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.revokeUser()}}},[e._v("Revoke")])],1)])],1)},staticRenderFns:[]},!1,function(e){r("Qgiq")},"data-v-d5c19714",null).exports,de={data:function(){return{user:{},avatarUrl:"/user/saveAvatar",rules:{password:[{required:!0,message:"Please enter password",trigger:"blur"}],email:[{validator:function(e,t,r){if(!o(t)&&!u(t))return r(new Error("Incorrect format"));r()},trigger:"blur"}],mobile:[{validator:function(e,t,r){if(!o(t)&&!c(t))return r(new Error("Incorrect format"));r()},trigger:"blur"}]},updateUserLoading:!1}},methods:{getUser:function(e){var t=this,r="/user/getUser/"+e;Le.get(r,null,function(e){var r=e.data;if(0==r.code){var a=r.data,s=a.avatar;o(s)||(a.avatar=""+s),t.user=a}else v.error("Get user failed"),t.user=t.currentUser},function(e){v.error(e)})},updateUser:function(e){var t=this;this.$refs[e].validate(function(e){e&&(t.updateUserLoading=!0,Le.post("/user/updateUser",t.user,function(e){0==e.data.code?v.success("update user successfully"):v.error("update user failed"),t.updateUserLoading=!1},function(e){t.updateUserLoading=!1,v.error(e)}))})},resetUser:function(e){this.getUser(this.currentUser.userId)},handleAvatarSuccess:function(e,t){var r=URL.createObjectURL(t.raw);this.user.avatar=r;var a=Ae.getters.getUser;a.avatar=r,Ae.dispatch("setUser",a)},beforeAvatarUpload:function(e){var t="image/jpeg"===e.type||"image/jpg",r=e.size/1024/1024<5;return t||v.error("Uploading images can only be in JPG or PNG format!"),r||v.error("Upload image size can't exceed 5MB!"),t&&r}},computed:{currentUser:function(){return Ae.getters.getUser}},mounted:function(){var e=this.currentUser.userId;e!=this.$route.params.userId&&this.$$router.push({name:"profile",params:{userId:e}}),this.getUser(e)}},pe=r("VU/8")(de,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.updateUserLoading,expression:"updateUserLoading"}],staticClass:"body-wrapper",attrs:{id:"profile"}},[r("div",{staticClass:"profile-wrapper"},[r("el-form",{ref:"user",attrs:{model:e.user,"status-icon":"","label-width":"100px",rules:e.rules}},[r("el-form-item",{attrs:{label:"Avatar"}},[r("el-upload",{staticClass:"avatar-uploader",attrs:{name:"avatarFile",action:e.avatarUrl,"show-file-list":!1,"on-success":e.handleAvatarSuccess,data:e.user,"before-upload":e.beforeAvatarUpload,title:"Change avatar"}},[null!=e.user.avatar&&""!=e.user.avatar?r("img",{staticClass:"avatar",staticStyle:{"object-fit":"cover"},attrs:{src:e.user.avatar}}):r("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),e._v(" "),r("el-form-item",{attrs:{label:"User Role",prop:"userRole"}},[0==e.user.userRole?r("el-tag",{attrs:{size:"small"}},[e._v("Super Admin")]):e._e(),e._v(" "),1==e.user.userRole?r("el-tag",{attrs:{size:"small"}},[e._v("Admin")]):e._e(),e._v(" "),2==e.user.userRole?r("el-tag",{attrs:{size:"small"}},[e._v("Member")]):e._e()],1),e._v(" "),r("el-form-item",{attrs:{label:"User Name",prop:"userName"}},[r("el-tag",{attrs:{size:"small"}},[e._v(e._s(e.user.userName))])],1),e._v(" "),r("el-form-item",{attrs:{label:"Password",prop:"password"}},[r("el-input",{attrs:{size:"small",type:"password",maxlength:"255","show-password":""},model:{value:e.user.password,callback:function(t){e.$set(e.user,"password","string"==typeof t?t.trim():t)},expression:"user.password"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Email",prop:"email"}},[r("el-input",{attrs:{size:"small"},model:{value:e.user.email,callback:function(t){e.$set(e.user,"email","string"==typeof t?t.trim():t)},expression:"user.email"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Mobile",prop:"mobile"}},[r("el-input",{attrs:{size:"small"},model:{value:e.user.mobile,callback:function(t){e.$set(e.user,"mobile",e._n(t))},expression:"user.mobile"}})],1),e._v(" "),r("el-form-item",[r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.updateUser("user")}}},[e._v("Update")]),e._v(" "),r("el-button",{attrs:{size:"small"},on:{click:function(t){return e.resetUser("user")}}},[e._v("Reset")])],1)],1)],1)])},staticRenderFns:[]},!1,function(e){r("As7w")},"data-v-60485a73",null).exports,me={components:{codemirror:A.codemirror},data:function(){return{histrory:"",clusterList:[],dbList:[],selectedClusterId:"",selectedCluster:{},database:"",command:"",connected:!1,consoleDisabled:!0}},methods:{getClusterList:function(e){var t=this,r="/cluster/getClusterList/"+e;o(e)||Le.get(r,null,function(e){var r=e.data;0==r.code?t.clusterList=r.data:v.error("Get cluster list failed")},function(e){v.error(e)})},resetStatus:function(){this.consoleDisabled=!0,this.connected=!1,this.dbList=[],this.database="",this.histrory=""},getDBList:function(e){var t=this;if(o(e))v.warning("Please select cluster");else if(this.clusterList.forEach(function(r){r.clusterId==e&&(t.selectedCluster=r)}),this.resetStatus(),"cluster"!=this.selectedCluster.redisMode){var r="/data/getDBList/"+e;Le.get(r,null,function(e){t.dbList=[];var r=e.data;0==r.code?r.data.forEach(function(e){var r=e.database;t.dbList.push(r.slice(2))}):v.error(r.message)},function(e){v.error(e)})}else this.dbList.push(0)},handleSelectDB:function(e){o(e)||(this.consoleDisabled=!1,this.connected=!0)},sendCommand:function(e){var t=this;Le.post("/data/sendCommand",e,function(e){var r=e.data;if(0==r.code){var a=r.data;"string"!=typeof a&&(a=S()(a)),t.histrory+="["+t.selectedCluster.clusterName+"]$ "+t.command+"<br/>"+a+"<br/>"}else t.histrory+="["+t.selectedCluster.clusterName+"]$ "+t.command+"\n no data or operation failed or command not support \n";t.command=""},function(e){v.error(e)})},keyUpEnter:function(){if(!o(this.command)){if("clear"==this.command)return this.histrory="",void(this.command="");if(o(this.selectedClusterId))v.warning("Please select cluster");else if(o(this.database))v.warning("Please select database");else{var e={clusterId:this.selectedClusterId,database:this.database,command:this.command};this.sendCommand(e)}}},reset:function(){this.histrory="",this.clusterList=[],this.dbList=[],this.selectedClusterId="",this.selectedCluster={},this.database="",this.command=""}},computed:{currentGroup:function(){return Ae.getters.getCurrentGroup}},watch:{currentGroup:function(e){this.reset(),this.getClusterList(e.groupId),this.$router.push({name:"data-operation",params:{groupId:e.groupId}})}},mounted:function(){this.getClusterList(this.currentGroup.groupId)}},fe=r("VU/8")(me,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"body-wrapper",attrs:{id:"data-operation"}},[r("el-row",[r("el-col",{staticClass:"select-wrapper",attrs:{xl:24,lg:24,md:24,sm:24}},[r("el-select",{attrs:{size:"small",placeholder:"Select cluster"},on:{change:function(t){return e.getDBList(e.selectedClusterId)}},model:{value:e.selectedClusterId,callback:function(t){e.selectedClusterId=t},expression:"selectedClusterId"}},e._l(e.clusterList,function(e){return r("el-option",{key:e.clusterId,attrs:{label:e.clusterName,value:e.clusterId}})}),1),e._v(" "),r("el-select",{attrs:{size:"small",placeholder:"Select db",filterable:"","allow-create":""},on:{change:function(t){return e.handleSelectDB(e.database)}},model:{value:e.database,callback:function(t){e.database=t},expression:"database"}},e._l(e.dbList,function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1),e._v(" "),r("el-col",{attrs:{xl:24,lg:24,md:24,sm:24}},[r("div",{staticClass:"console-wrapper"},[r("div",{staticClass:"console-title"},[e._v("Redis Command")]),e._v(" "),r("div",{staticClass:"console"},[e.connected?r("div",{staticClass:"connected"},[e._v("Redis connected...")]):e._e(),e._v(" "),r("div",{staticClass:"command-history-wrapper"},[r("div",{staticClass:"history",domProps:{innerHTML:e._s(e.histrory)}})]),e._v(" "),r("div",{staticClass:"command"},[r("div",{staticStyle:{"max-width":"50%","margin-right":"5px"}}),e._v(" "),r("el-input",{staticClass:"command-input",attrs:{size:"small",type:"text",disabled:e.consoleDisabled},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.keyUpEnter(e.command)}},model:{value:e.command,callback:function(t){e.command=t},expression:"command"}},[r("template",{slot:"prepend"},[e._v("["+e._s(e.selectedCluster.clusterName)+"]$")])],2)],1)])])])],1)],1)},staticRenderFns:[]},!1,function(e){r("dqEZ")},"data-v-28725923",null).exports,ve={components:{codemirror:A.codemirror},data:function(){return{histrory:"",command:""}},methods:{sendCommand:function(e){var t=this;Le.post("/data/executeCommand",e,function(e){var r=e.data;if(0==r.code){var a=r.data;"string"!=typeof a&&(a=S()(a)),t.histrory+="$ "+t.command+"<br/>"+a+"<br/>"}else t.histrory+="$ "+t.command+"\n no data or operation failed or command not support \n";t.command=""},function(e){v.error(e)})},keyUpEnter:function(){if(!o(this.command)){if("clear"==this.command)return this.histrory="",void(this.command="");var e={command:this.command};this.sendCommand(e)}},reset:function(){this.histrory="",this.command=""}},computed:{currentGroup:function(){return Ae.getters.getCurrentGroup}},watch:{currentGroup:function(e){this.reset(),this.$router.push({name:"system-operation",params:{groupId:e.groupId}})}},mounted:function(){}},he=r("VU/8")(ve,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"body-wrapper",attrs:{id:"system-operation"}},[r("el-row",[r("el-col",{attrs:{xl:24,lg:24,md:24,sm:24}},[r("div",{staticClass:"console-wrapper"},[r("div",{staticClass:"console-title"},[e._v("System Command")]),e._v(" "),r("div",{staticClass:"console"},[r("div",{staticClass:"command-history-wrapper"},[r("div",{staticClass:"history",domProps:{innerHTML:e._s(e.histrory)}})]),e._v(" "),r("div",{staticClass:"command"},[r("div",{staticStyle:{"max-width":"50%","margin-right":"5px"}}),e._v(" "),r("el-input",{staticClass:"command-input",attrs:{size:"small",type:"text"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.keyUpEnter(e.command)}},model:{value:e.command,callback:function(t){e.command=t},expression:"command"}},[r("template",{slot:"prepend"},[e._v("$")])],2)],1)])])])],1)],1)},staticRenderFns:[]},!1,function(e){r("o1mp")},"data-v-74e08810",null).exports,ge={methods:{toDashboard:function(){this.$router.push({name:"dashboard",params:{groupId:this.currentGroup.groupId}})}},computed:{currentGroup:function(){return Ae.getters.getCurrentGroup}}},be=r("VU/8")(ge,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"page-container"},[r("p",{staticClass:"code"},[e._v("404")]),e._v(" "),r("div",[r("el-link",{on:{click:function(t){return e.toDashboard()}}},[e._v("Back to home page")])],1)])},staticRenderFns:[]},!1,function(e){r("JwGp")},"data-v-529d0beb",null).exports,_e={data:function(){return{historyList:[],currentPageNo:1,pageSize:10,totalPage:0,paginationShow:!1,totalCount:0}},methods:{loadHistoryData:function(e){var t=this,r="/operation/group/"+e+"?pageNo="+this.currentPageNo;Le.get(r,null,function(e){var r=e.data;if(0==r.code){var a=r.data.logData;a.forEach(function(e){e.logTime=C(e.logTime)}),t.historyList=a,t.totalCount=r.data.totalCount,t.totalPage=r.data.totalPage,t.totalPage>1&&(t.paginationShow=!0)}else v.error("Get edit history list failed")},function(e){401===e.response.status?(v.error("Session Timeout! Please Login again"),t.$router.push({name:"login"})):v.error(e)})},handleCurrentChange:function(e){this.currentPageNo=e;var t=this.currentGroupId;this.loadHistoryData(t)},getIndex:function(e){return this.indexBasic+e+1}},computed:{currentGroupId:function(){return Ae.getters.getCurrentGroup.groupId},indexBasic:function(){return(this.currentPageNo-1)*this.pageSize}},watch:{currentGroupId:function(e){this.currentPageNo=1,this.pageSize=10,this.totalPage=0,this.paginationShow=!1,this.totalCount=0,this.loadHistoryData(e)}},mounted:function(){var e=this.currentGroupId;this.loadHistoryData(e)}},Ce=r("VU/8")(_e,{render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"body-wrapper",staticStyle:{display:"none"},style:{display:"block"},attrs:{id:"rule-manage"}},[r("div",[r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.historyList,stripe:""}},[r("el-table-column",{attrs:{type:"index",index:e.getIndex,label:"ID","min-width":"15%"}}),e._v(" "),r("el-table-column",{attrs:{prop:"groupName",label:"GroupName","min-width":"15%"}}),e._v(" "),r("el-table-column",{attrs:{prop:"userName",label:"UserName","min-width":"15%"}}),e._v(" "),r("el-table-column",{attrs:{prop:"userIp",label:"UserIP","min-width":"15%"}}),e._v(" "),r("el-table-column",{attrs:{prop:"operationInfo",label:"OperationInfo","min-width":"20%"}}),e._v(" "),r("el-table-column",{attrs:{prop:"logTime",label:"LogTime","min-width":"20%"}})],1)],1),e._v(" "),r("div",{staticClass:"block"},[e.paginationShow?r("el-pagination",{staticStyle:{"text-align":"center"},attrs:{"current-page":e.currentPageNo,"page-size":e.pageSize,layout:"prev, pager, next, jumper",total:e.totalCount},on:{"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.currentPageNo=t},"update:current-page":function(t){e.currentPageNo=t}}}):e._e()],1)])},staticRenderFns:[]},!1,function(e){r("rA2g")},"data-v-05116486",null).exports;a.default.use(h.a);var we=h.a.prototype.push;h.a.prototype.push=function(e){return we.call(this,e).catch(function(e){return e})};var ye=new h.a({mode:"history",routes:[{path:"/login",name:"login",component:_,hidden:!0},{path:"/",name:"index",component:R,children:[{name:"dashboard",path:"/dashboard/group/:groupId",component:E},{name:"redis-monitor",path:"/redis-monitor/cluster/:clusterId",component:q},{name:"redis-manage",path:"/redis-manage/cluster/:clusterId",component:j},{name:"installation",path:"/installation/group/:groupId",component:J},{name:"channel-manage",path:"/channel-manage/group/:groupId",component:ee},{name:"rule-manage",path:"/rule-manage/group/:groupId",component:re},{name:"alert-manage",path:"/alert-manage/cluster/:clusterId",component:se},{name:"machine-manage",path:"/machine-manage/group/:groupId",component:ie},{name:"group-manage",path:"/group-manage",component:oe},{name:"user-manage",path:"/user-manage/group/:groupId",component:ce},{name:"edit-history",path:"/history/group/:groupId",component:Ce},{name:"profile",path:"/profile/:userId",component:pe},{name:"data-operation",path:"/data-operation/group/:groupId",component:fe},{name:"system-operation",path:"/system-operation/group/:groupId",component:he}]},{path:"/404",component:be,name:"404",hidden:!0},{path:"*",hidden:!0,redirect:{path:"/404"}}]}),ke=ye;function Ie(e,t,r,a,s){l()({method:e,url:t,headers:{UserIp:Ae.getters.getUserIp},data:"POST"===e||"PUT"===e?r:null,params:"GET"===e||"DELETE"===e?r:null}).then(function(e){a(e)}).catch(function(e){401===e.response.status?(v.warning("Session timeout"),ke.push({name:"login"})):s(e)})}ye.beforeEach(function(e,t,r){var a=Ae.getters.getUser,s=e.path;if("/login"!==s&&(o(a)||o(a.userId)||o(a.userName)||o(a.userRole))){var n=e.query.code;if(o(n))r({path:"login"});else{var i="/user/oauth2Login?code="+n;Le.get(i,null,function(e){var t=e.data;0===t.code?(Ae.dispatch("setUser",t.data),r()):r({path:"login"})},function(){r({path:"login"})})}}else 1===a.userRole&&s.indexOf("group-manage")>0?r({name:"dashboard",params:{groupId:Ae.getters.getCurrentGroup.groupId}}):2===a.userRole&&(s.indexOf("group-manage")>0||s.indexOf("user-manage")>0||s.indexOf("machine-manage")>0||s.indexOf("installation")>0||s.indexOf("channel-manage")>0||s.indexOf("rule-manage")>0||s.indexOf("redis-manage")>0||s.indexOf("alert-manage")>0||s.indexOf("edit-history")>0)?r({name:"dashboard",params:{groupId:Ae.getters.getCurrentGroup.groupId}}):r()});var Le={get:function(e,t,r,a){return Ie("GET",e,t,r,a)},post:function(e,t,r,a){return Ie("POST",e,t,r,a)},put:function(e,t,r,a){return Ie("PUT",e,t,r,a)},delete:function(e,t,r,a){return Ie("DELETE",e,t,r,a)}},Ne=r("lbHh");a.default.use(s.a);var Re={currentGroup:{},groupList:[],user:{userRole:2},installationEnvironmentList:[],authorization:{},userIp:""},xe={setCurrentGroup:function(e,t){(function(e,t){if(!o(e)&&!o(t)){var r={groupId:e,userId:t};Le.post("/user/getUserRole/",r,function(e){var t=e.data.data;Re.user.userRole=t},function(){Re.user.userRole=2})}})(t.groupId,e.user.userId),e.currentGroup=t},setGroupList:function(e,t){e.groupList=t},setUser:function(e,t){e.user=t},setUserRole:function(e,t){e.user.userRole=t},setInstallationEnvironmentList:function(e,t){e.installationEnvironmentList=t},setAuthorization:function(e,t){e.authorization=t},setUserIp:function(e,t){e.userIp=t}},Se={setCurrentGroup:function(e,t){e.commit("setCurrentGroup",t)},setGroupList:function(e,t){e.commit("setGroupList",t)},setUser:function(e,t){var r=t.avatar;o("")||o(r)||r.startsWith("")||r.startsWith("http")||(t.avatar=""+r),e.commit("setUser",t)},setUserRole:function(e,t){e.commit("setUserRole",t)},setInstallationEnvironmentList:function(e,t){e.commit("setInstallationEnvironmentList",t)},setAuthorization:function(e,t){e.commit("setAuthorization",t)},setUserIp:function(e,t){e.commit("setUserIp",t)}},Ae=new s.a.Store({state:Re,getters:{getCurrentGroup:function(e){return e.currentGroup},getGroupList:function(e){return e.groupList},getUser:function(e){return e.user},getUserId:function(e){return e.user.userId},getUserRole:function(e){return e.user.userRole},getInstallationEnvironmentList:function(e){return e.installationEnvironmentList},getAuthorization:function(e){return e.authorization},getUserIp:function(e){return e.userIp}},actions:Se,mutations:xe,plugins:[Object(n.a)({storage:{getItem:function(e){return Ne.get(e)},setItem:function(e,t){return Ne.set(e,t,{expires:1})},removeItem:function(e){return Ne.remove(e)}},reducer:function(e){return{user:e.user,currentGroup:e.currentGroup,groupList:e.groupList}}})]});var Pe={name:"App",methods:{getInstallationEnvironmentList:function(){Le.get("/system/getInstallationEnvironment",null,function(e){var t=[];e.data.data.forEach(function(e){var r="";0==e?r="Docker":1==e?r="Machine":3==e&&(r="Humpback"),o(r)||t.push({type:e,name:r})}),Ae.dispatch("setInstallationEnvironmentList",t)},function(e){v.error("Get installation environment failed")})}},mounted:function(){this.getInstallationEnvironmentList()}},Ue=r("VU/8")(Pe,{render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("transition",{attrs:{name:"fade",mode:"out-in"}},[t("router-view")],1)],1)},staticRenderFns:[]},!1,function(e){r("GX4J")},null,null).exports,Ve=r("wUZ8"),Ee=r.n(Ve);r("tvR6"),r("Xcu2"),r("7xIN"),a.default.use(m.a,{locale:Ee.a}),a.default.config.productionTip=!1,a.default.prototype.$axios=l.a,l.a.defaults.headers.post["Content-Type"]="application/json;charset=UTF-8",l.a.defaults.baseURL="",l.a.defaults.TIMEOUT=3e5,new a.default({el:"#app",vuex:s.a,router:ke,components:{App:Ue},template:"<App/>"})},OQxI:function(e,t){},PsxY:function(e,t){},Qgiq:function(e,t){},TMx1:function(e,t){},V3UU:function(e,t){},V7r3:function(e,t){},Xcu2:function(e,t){},"cf+J":function(e,t,r){e.exports=r.p+"static/img/background.f7a455c.png"},dqEZ:function(e,t){},fUwY:function(e,t){},gSgD:function(e,t){},idhF:function(e,t){},jR2h:function(e,t){},nLbs:function(e,t){},nhBv:function(e,t,r){e.exports=r.p+"static/img/redis-manager.e22ccc2.png"},o1mp:function(e,t){},oe5G:function(e,t){},p92f:function(e,t){},rA2g:function(e,t){},tvR6:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.2925146851d418a1208e.js.map